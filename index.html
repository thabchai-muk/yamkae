<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà - The Golden Age Selection</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --pt-yellow: #F5DF4D; --pt-gray: #939597; --pt-dark: #333333; --pt-red: #dc3545; --pt-green: #198754; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; color: var(--pt-dark); padding-bottom: 80px; }
        .admin-only { display: none !important; } 
        .is-admin .admin-only { display: block !important; }
        .cursor-pointer { cursor: pointer; }

        /* Navbar & Loader */
        .navbar { background: white; border-bottom: 4px solid var(--pt-yellow); padding: 10px 0; }
        .shop-logo-img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid var(--pt-yellow); margin-right: 10px; display: none; }
        .loader { display: flex; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:9999; justify-content:center; align-items:center; flex-direction: column; transition: opacity 0.5s; }
        .loader.hide { opacity: 0; pointer-events: none; }

        /* Carousel */
        .carousel-item img { height: 450px; object-fit: cover; filter: brightness(0.95); }

        /* Gift Section (Animation Style ‡∏à‡∏≤‡∏Å Local) */
        .gift-section { background: linear-gradient(135deg, #fff9c4 0%, #fff3e0 100%); padding: 60px 0; position: relative; overflow: hidden; }
        .gift-section::before { content: '\f06b'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: -20px; right: -20px; font-size: 15rem; color: rgba(245, 223, 77, 0.15); z-index: 0; transform: rotate(-15deg); }
        .gift-header-animate { display: inline-block; animation: float-gift 3s ease-in-out infinite; background: white; padding: 15px 40px; border-radius: 50px; box-shadow: 0 10px 25px rgba(245, 223, 77, 0.4); border: 3px solid var(--pt-yellow); position: relative; z-index: 1; }
        @keyframes float-gift { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-5px) rotate(2deg); } }

        /* Product Card */
        .product-card { border: 1px solid #eee; border-radius: 12px; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); position: relative; cursor: pointer; overflow: hidden; height: 100%; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); border-color: var(--pt-yellow); }
        .card-img-top { height: 200px; width: 100%; object-fit: contain; background: #fff; padding: 5px; }
        .badge-tag { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 30px; font-size: 0.75rem; color: white; font-weight: bold; text-transform: uppercase; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2; }
        .tag-gift { background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; } 
        .tag-hot { background: var(--pt-red); } .tag-new { background: var(--pt-green); } .tag-recom { background: #0d6efd; } .tag-promo { background: #6f42c1; color: white; }

        /* Categories & Cart */
        .cat-menu-container { overflow-x: auto; white-space: nowrap; padding: 15px 0 25px; text-align: center; position: sticky; top: 76px; z-index: 9; background: #f8f9fa; }
        .cat-btn { border: 1px solid #ddd; background: white; color: var(--pt-dark); border-radius: 50px; padding: 8px 25px; margin: 0 5px; font-weight: 600; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-btn.active, .cat-btn:hover { background: var(--pt-gray); color: var(--pt-yellow); border-color: var(--pt-gray); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .cart-float { position: fixed; bottom: 30px; right: 30px; background: var(--pt-yellow); color: var(--pt-gray); width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(245, 223, 77, 0.6); cursor: pointer; z-index: 1000; border: 4px solid white; font-weight: bold; font-size: 1.5rem; transition: 0.3s; }
        
        /* Buffet Styles */
        .buffet-item { cursor: pointer; border: 1px solid #eee; border-radius: 8px; overflow: hidden; position: relative; background:white; transition: 0.2s; }
        .buffet-item:hover { transform: scale(1.02); border-color: var(--pt-yellow); }
        .buffet-item.selected { border: 2px solid var(--pt-green); background-color: #f0fff4; }
        .buffet-item.selected::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 5px; right: 5px; background: var(--pt-green); color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .buffet-progress { background: #fff3cd; border: 1px dashed #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: center; }
        .control-panel-sticky { position: sticky; top: 10px; height: calc(100vh - 100px); display: flex; flex-direction: column; overflow-y: auto; }
        .modal-footer-sticky { position: sticky; bottom: 0; background: white; padding: 15px; border-top: 1px solid #eee; z-index: 100; text-align: center; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }

        /* Checkout & Admin */
        .checkout-card { background: white; padding: 20px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; }
        .admin-panel { display: none; background: #fff; border-top: 5px solid var(--pt-yellow); padding: 30px; margin: 40px auto; border-radius: 10px; max-width: 900px; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); position: relative; }
        .admin-panel.minimized { height: 60px; overflow: hidden; padding: 10px 30px; bottom: 0; position: fixed; margin: 0; width: 100%; max-width: 100%; border-radius: 0; z-index: 9999; }
        .upload-box { border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer; background: #f9f9f9; height: 150px; display: flex; align-items: center; justify-content: center; background-size: contain; background-repeat: no-repeat; background-position: center; }

        footer { background-color: #343a40; color: #adb5bd; padding-top: 3rem; padding-bottom: 1.5rem; margin-top: 4rem; }
        footer a { color: #adb5bd; text-decoration: none; } footer a:hover { color: var(--pt-yellow); }
        footer .social-icon { font-size: 1.5rem; margin-right: 15px; color: #adb5bd; display: none; }
    </style>
</head>
<body id="body">

    <div id="loader" class="loader">
        <div class="spinner-border text-secondary"></div>
        <div class="mt-3 fw-bold text-secondary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå...</div>
    </div>

    <nav class="navbar sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="" id="navbarLogo" class="shop-logo-img">
                <div><div class="fs-5 fw-bold" id="navShopName">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</div><div style="font-size: 0.7rem; color: #999;">The Golden Age Selection</div></div>
            </a>
            <div class="d-flex align-items-center gap-2">
                <button id="btnLineContact" class="btn btn-sm btn-success rounded-pill px-3 shadow-sm" style="display:none;"><i class="fab fa-line"></i> Line</button>
                <button class="btn btn-sm btn-outline-dark rounded-pill px-3" onclick="openAboutModal()"><i class="fas fa-info-circle"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>
                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3" onclick="toggleAdmin()"><i class="fas fa-cog"></i></button>
            </div>
        </div>
    </nav>

    <div id="heroCarousel" class="carousel slide carousel-fade shadow-sm" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
            <div class="carousel-item"><img src="https://images.unsplash.com/photo-1511184150666-9eb715131de6?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
        </div>
    </div>

    <div class="gift-section shadow-sm" id="giftSection">
        <div class="container position-relative" style="z-index: 1;">
            <div class="text-center mb-5">
                <div class="gift-header-animate mb-3"><h2 class="fw-bold m-0" style="color:#5d4037">üéÅ ‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏ó‡∏ô‡πÉ‡∏à</h2></div>
                <p class="text-muted fs-5">"‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å...‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ"</p>
                <p class="small text-secondary">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏Ñ‡∏∏‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤</p>
            </div>
            <div class="row g-4 justify-content-center px-3" id="listGift">
                <div class="col-12 text-center text-muted py-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>
    </div>

    <div class="cat-menu-container shadow-sm" id="userCatFilter">
        <button class="cat-btn active" onclick="filterProducts('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div class="container mt-4" style="min-height: 60vh;">
        <div class="row justify-content-center mb-5"><div class="col-md-6"><input type="text" id="searchInput" class="form-control rounded-pill text-center shadow-sm" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="searchProduct()"></div></div>

        <div id="highlightZone">
            <div id="secHot" class="mb-5"><div class="d-flex align-items-center mb-3"><h3 class="fw-bold m-0">üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div><div class="row g-4" id="listHot"></div></div>
            <div id="secRecom" class="mb-5"><div class="d-flex align-items-center mb-3"><h3 class="fw-bold m-0">‚≠ê ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div><div class="row g-4" id="listRecom"></div></div>
        </div>

        <div class="d-flex align-items-center mb-3 mt-5"><h3 class="fw-bold m-0">üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div>
        <div class="row g-4" id="productList">
            <div class="col-12 text-center text-muted py-5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</div>
        </div>
    </div>

    <footer class="bg-dark text-light py-5 mt-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-6">
                    <h5 class="text-warning">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</h5>
                    <p class="small text-muted">‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏ß‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å</p>
                </div>
                <div class="col-md-6">
                    <h5 class="text-warning">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏≤</h5>
                    <div class="mb-3">
                        <a href="#" id="linkFb" class="social-icon" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="#" id="linkIg" class="social-icon" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="#" id="linkTiktok" class="social-icon" target="_blank"><i class="fab fa-tiktok"></i></a>
                    </div>
                    <p class="small text-muted"><i class="fas fa-phone me-2"></i> <span id="footerContact">-</span></p>
                </div>
            </div>
            <hr class="border-secondary">
            <div class="text-center small text-muted">&copy; 2023 ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà. All rights reserved.</div>
        </div>
    </footer>

    <div class="container pb-5">
        <div id="adminPanel" class="admin-panel shadow-lg">
            <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                <h4 class="text-dark fw-bold">‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h4>
                <div>
                    <button class="btn btn-sm btn-success fw-bold me-2 px-3" onclick="seedData()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
                    <button class="btn btn-sm btn-outline-danger fw-bold me-2 px-3" onclick="document.getElementById('adminPanel').style.display='none'">‚ùå ‡∏õ‡∏¥‡∏î</button>
                    <button class="btn btn-sm btn-outline-primary" onclick="toggleAdminMin()">[-] ‡∏¢‡πà‡∏≠</button>
                </div>
            </div>
            <ul class="nav nav-pills nav-fill mb-4 gap-2">
                <li class="nav-item"><button class="nav-link active bg-secondary text-white" data-bs-toggle="tab" data-bs-target="#tab-product">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-orders">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-cat">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-shop">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-product">
                    <div id="editAlert" class="alert alert-warning d-none">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç... <button class="btn btn-sm btn-light float-end" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div>
                    <div class="row g-2">
                        <div class="col-6"><input type="text" id="p_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"></div>
                        <div class="col-3"><input type="number" id="p_price" class="form-control form-control-sm" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤"></div>
                        <div class="col-3"><input type="number" id="p_credit" class="form-control form-control-sm" placeholder="‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (Gift)"></div>
                        <div class="col-6"><select id="p_category" class="form-select form-select-sm"><option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option></select></div>
                        <div class="col-6"><select id="p_badge" class="form-select form-select-sm"><option value="">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="gift">üéÅ Gift Set</option><option value="hot">üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</option><option value="recom">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option></select></div>
                        <div class="col-12"><div class="upload-box" onclick="document.getElementById('p_file').click()" id="uploadZone"><small>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</small></div><input type="file" id="p_file" class="d-none" accept="image/*" onchange="previewImage(this)"><input type="hidden" id="p_base64_storage"><input type="hidden" id="p_image"></div>
                        <div class="col-12"><button onclick="saveProduct()" class="btn btn-warning w-100 btn-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>
                    </div>
                    <hr>
                    <div class="list-group small" id="adminProductList" style="max-height:300px; overflow-y:auto;"></div>
                </div>
                <div class="tab-pane fade" id="tab-cat">
                    <div class="input-group mb-3">
                        <input type="text" id="newCatName" class="form-control form-control-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà...">
                        <button class="btn btn-success btn-sm" onclick="addCategory()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                    <ul class="list-group small" id="adminCatList"></ul>
                </div>
                <div class="tab-pane fade" id="tab-shop">
                    <div class="row g-2">
                        <div class="col-6"><input type="text" id="conf_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô"></div>
                        <div class="col-6"><input type="text" id="conf_line_id" class="form-control form-control-sm" placeholder="LINE ID"></div>
                        <div class="col-12"><input type="text" id="conf_desc" class="form-control form-control-sm" placeholder="‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢"></div>
                        <div class="col-6"><input type="text" id="conf_contact" class="form-control form-control-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"></div>
                        <div class="col-12"><textarea id="conf_payment" class="form-control form-control-sm" rows="2" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"></textarea></div>
                        <div class="col-12 fw-bold small mt-2">Social Links:</div>
                        <div class="col-4"><input type="text" id="conf_fb" class="form-control form-control-sm" placeholder="Link FB"></div>
                        <div class="col-4"><input type="text" id="conf_ig" class="form-control form-control-sm" placeholder="Link IG"></div>
                        <div class="col-4"><input type="text" id="conf_tiktok" class="form-control form-control-sm" placeholder="Link TikTok"></div>
                        <div class="col-12 mt-2"><button onclick="saveShopConfig()" class="btn btn-secondary w-100 btn-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button></div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab-orders"><div id="adminOrderList" class="text-center py-5 text-muted">...</div></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="buffetModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning"><h5 class="modal-title fw-bold">üéÅ ‡∏à‡∏±‡∏î‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body bg-light p-0">
                    <div class="row g-0">
                        <div class="col-lg-8 p-3" style="max-height: 70vh; overflow-y: auto;">
                            <div class="card border-0 shadow-sm mb-3 sticky-top" style="top:0; z-index:5;"><div class="card-body p-2"><div class="d-flex justify-content-between align-items-center mb-2"><small>‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï:</small> <span class="fw-bold text-primary" id="buffetTarget">0</span></div><input type="text" id="searchBuffet" class="form-control border-0" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á..." onkeyup="filterBuffetItems()"></div></div>
                            <div class="row g-2" id="buffetItemsList"></div>
                        </div>
                        <div class="col-lg-4 bg-white border-start p-0">
                            <div class="control-panel-sticky p-3">
                                <div class="buffet-progress"><div class="small fw-bold">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á</div><h3 class="fw-bold text-primary mb-0"><span id="buffetCurrentTotal">0</span> / <span id="buffetMaxTotal">0</span></h3><div class="progress mt-2" style="height: 10px;"><div id="buffetProgressBar" class="progress-bar bg-success" style="width: 0%"></div></div><div class="small text-danger mt-1 fw-bold" id="buffetWarning"></div></div><hr>
                                <div class="mb-3"><label class="fw-bold small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á</label><select id="buffetBoxStyle" class="form-select form-select-sm"><option value="‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° (‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á)</option><option value="‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ (‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á)</option><option value="‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ">ü™µ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ (‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à)</option></select></div>
                                <div class="mb-3"><label class="fw-bold small">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î</label><textarea id="buffetCardMsg" class="form-control form-control-sm" rows="3" placeholder="‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö..."></textarea></div>
                            </div>
                            <div class="modal-footer-sticky mt-auto"><button class="btn btn-success w-100 fw-bold py-3 shadow-sm" id="btnFinishBuffet" onclick="finishBuffet()" disabled><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning"><h5 class="modal-title fw-bold">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body row g-3">
                    <div class="col-lg-7 border-end"><div id="cartItemsContainer" style="max-height: 400px; overflow-y: auto;"></div></div>
                    <div class="col-lg-5">
                        <div class="checkout-card bg-light">
                            <h6 class="fw-bold mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h6>
                            <input type="text" id="cust_name" class="form-control form-control-sm mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            <input type="tel" id="cust_tel" class="form-control form-control-sm mb-2" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
                            <textarea id="cust_addr" class="form-control form-control-sm mb-3" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á"></textarea>
                            <hr>
                            <label class="small fw-bold">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                            <div class="d-flex gap-3 mb-2">
                                <div class="form-check"><input class="form-check-input" type="radio" name="ship" id="ship1" value="50" checked onchange="calcTotal()"><label class="form-check-label small" for="ship1">EMS (50.-)</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="ship" id="ship2" value="0" onchange="calcTotal()"><label class="form-check-label small" for="ship2">‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</label></div>
                            </div>
                            <label class="small fw-bold">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <div class="d-flex gap-3 mb-2">
                                <div class="form-check"><input class="form-check-input" type="radio" name="pay" id="pay1" value="transfer" checked onchange="togglePay('transfer')"><label class="form-check-label small" for="pay1">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="pay" id="pay2" value="cod" onchange="togglePay('cod')"><label class="form-check-label small" for="pay2">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</label></div>
                            </div>
                            <div id="bankBox" class="alert alert-light border small p-2"><div id="bankInfoText" class="fw-bold mb-1">-</div><input type="file" id="cust_slip" class="form-control form-control-sm"></div>
                            <div class="d-flex justify-content-between mt-3 fw-bold fs-5"><span>‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span id="finalPrice" class="text-danger">0.-</span></div>
                            <button class="btn btn-success w-100 mt-3 py-2 fw-bold" onclick="confirmOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="productDetailModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body text-center p-4"><img id="d_img" class="img-fluid rounded mb-3" style="max-height:300px;"><h4 id="d_name" class="fw-bold"></h4><h5 id="d_price" class="text-danger fw-bold my-3"></h5><p id="d_desc" class="text-muted small"></p><button id="d_btn" class="btn btn-warning w-100 rounded-pill fw-bold">‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></div></div></div></div>

    <div class="modal fade" id="aboutModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title fw-bold text-dark">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-4"><img id="aboutLogo" src="" class="rounded-circle border border-3 border-warning mb-3" style="width:100px;height:100px;object-fit:cover;display:none;"><h4 id="aboutName" class="fw-bold"></h4><p id="aboutDesc" class="text-muted"></p><hr><p class="mb-2"><i class="fas fa-phone-alt text-warning"></i> <span id="aboutPhone"></span></p><p class="mb-3"><i class="fab fa-line text-success"></i> <span id="aboutLine"></span></p><div class="d-flex justify-content-center gap-2" id="aboutSocials"></div><div class="alert alert-light border text-start small mt-3" id="aboutPayment"></div></div></div></div></div>

    <div class="cart-float shadow-lg" onclick="openCart()"><i class="fas fa-shopping-basket"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white" id="cartCount">0</span></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
        const firebaseConfig = {
          apiKey: "AIzaSyBzfx5PBzXTJNDSznJgpkXlgcovGYdF4mE",
          authDomain: "yamkae-s.firebaseapp.com",
          projectId: "yamkae-s",
          storageBucket: "yamkae-s.firebasestorage.app",
          messagingSenderId: "826309769226",
          appId: "1:826309769226:web:f2ffd6252879c0155887f3",
          measurementId: "G-4EF58B2XYK"
        };
        // ------------------------------------

        let db; try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); } catch(e) { console.error(e); }

        let products = [], cart = [], shopConfig = {}, editId = null, shippingCost = 50, selectedPayment = 'transfer', categories = [], currentBuffet = null, buffetSelection = [];

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => document.getElementById('loader').classList.add('hide'), 800);
            if(db) { loadConfig(); loadCategories(); loadProducts(); loadOrders(); }
            document.getElementById('curYear').innerText = new Date().getFullYear();
        });

        // --- Core Functions ---
        function loadProducts() {
            db.collection("products").onSnapshot(snap => {
                products = []; snap.forEach(d => { let p=d.data(); p.id=d.id; products.push(p); });
                renderFront(); renderAdminProducts();
            });
        }
        function renderFront() {
            const giftBox = document.getElementById('listGift'); giftBox.innerHTML = "";
            const prodBox = document.getElementById('productList'); prodBox.innerHTML = "";
            
            if(products.length === 0) { 
                giftBox.innerHTML = "<div class='col-12 text-center text-muted'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>";
                prodBox.innerHTML = "<div class='col-12 text-center text-muted py-5'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Å‡∏î Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á)</div>";
                return; 
            }
            
            products.forEach(p => {
                let tag = "";
                if(p.badge==='gift') tag='<span class="badge-tag tag-gift">üéÅ ‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á</span>';
                else if(p.badge==='hot') tag='<span class="badge-tag tag-hot">üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</span>';
                else if(p.badge==='recom') tag='<span class="badge-tag tag-recom">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>';
                
                let cardClick = `viewDetail('${p.id}')`;
                let btnAction = `addToCart('${p.id}')`; 
                let btnText = "‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤";
                
                if(p.badge==='gift') { 
                    cardClick = `startBuffet('${p.id}')`;
                    btnAction = `startBuffet('${p.id}')`; 
                    btnText = "‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏•‡∏¢"; 
                }

                const html = `
                <div class="col-6 col-lg-3 d-flex align-items-stretch">
                    <div class="product-card w-100" onclick="${cardClick}">
                        ${tag}
                        <img src="${p.image || 'https://via.placeholder.com/300'}" class="card-img-top">
                        <div class="p-3">
                            <small class="text-muted">${p.category||'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</small>
                            <h6 class="fw-bold text-truncate">${p.name}</h6>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="text-danger fw-bold">${Number(p.price).toLocaleString()}.-</span>
                                <button class="btn btn-sm btn-warning rounded-pill shadow-sm px-3" onclick="event.stopPropagation(); ${btnAction}">${btnText}</button>
                            </div>
                        </div>
                    </div>
                </div>`;
                
                if(p.badge==='gift') giftBox.innerHTML += html;
                else prodBox.innerHTML += html;
            });
        }

        // --- Cart & Checkout ---
        function addToCart(id) {
            let p = products.find(x => x.id === id);
            let item = cart.find(x => x.id === id);
            if(item) item.qty++; else cart.push({...p, qty: 1});
            updateCartBadge(); openCart();
        }
        function updateCartBadge() { document.getElementById('cartCount').innerText = cart.reduce((s,i)=>s+i.qty,0); }
        function openCart() { renderCartItems(); calcTotal(); new bootstrap.Modal(document.getElementById('cartModal')).show(); }
        function renderCartItems() {
            const div = document.getElementById('cartItemsContainer'); div.innerHTML = "";
            if(cart.length===0) { div.innerHTML="<div class='text-center py-5 text-muted'>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>"; return; }
            cart.forEach((i, idx) => {
                let extra = i.isBuffet ? `<div class="small text-success ps-2 border-start">${i.buffetItems.map(b=>b.name).join(', ')}</div>` : '';
                div.innerHTML += `<div class="d-flex align-items-start border-bottom pb-2 mb-2"><img src="${i.image}" width="50" class="rounded me-2"><div class="flex-grow-1"><div class="d-flex justify-content-between"><span class="fw-bold small">${i.name}</span><i class="fas fa-times text-danger cursor-pointer" onclick="cart.splice(${idx},1); openCart(); updateCartBadge();"></i></div>${extra}<div class="d-flex justify-content-between align-items-center mt-1"><span class="text-muted small">${Number(i.price).toLocaleString()}.-</span><span class="fw-bold">x ${i.qty}</span></div></div></div>`;
            });
        }
        function calcTotal() {
            let ship = document.querySelector('input[name="ship"]:checked').value;
            let sub = cart.reduce((s,i)=>s+(i.price*i.qty),0);
            document.getElementById('finalPrice').innerText = (sub + parseInt(ship)).toLocaleString() + ".-";
        }
        function togglePay(type) { document.getElementById('bankBox').style.display = type==='cod' ? 'none' : 'block'; }
        
        async function confirmOrder() {
            if(cart.length===0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
            const name = document.getElementById('cust_name').value;
            const tel = document.getElementById('cust_tel').value;
            const addr = document.getElementById('cust_addr').value;
            if(!name || !tel || !addr) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
            
            document.getElementById('loader').classList.remove('hide');
            let ship = document.querySelector('input[name="ship"]:checked').value;
            let pay = document.querySelector('input[name="pay"]:checked').value;
            
            await db.collection("orders").add({
                customer: {name, tel, address: addr},
                items: cart,
                total: document.getElementById('finalPrice').innerText,
                shipping: ship,
                payment: pay,
                time: new Date().toLocaleString()
            });
            
            alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            cart = []; updateCartBadge();
            document.getElementById('loader').classList.add('hide');
            bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
            
            if(shopConfig.lineId && confirm("‡πÅ‡∏à‡πâ‡∏á‡∏¢‡∏≠‡∏î‡∏ó‡∏≤‡∏á LINE?")) {
                window.open(`https://line.me/ti/p/~${shopConfig.lineId}`, '_blank');
            }
        }

        // --- Buffet Logic (Restored) ---
        function startBuffet(id) {
            currentBuffet = products.find(x => x.id === id);
            buffetSelection = [];
            document.getElementById('buffetName').innerText = currentBuffet.name;
            document.getElementById('buffetTarget').innerText = currentBuffet.credit || 1500;
            renderBuffetList();
            updateBuffetStat();
            new bootstrap.Modal(document.getElementById('buffetModal')).show();
        }
        function renderBuffetList() {
            const div = document.getElementById('buffetItemsList'); div.innerHTML = "";
            const txt = document.getElementById('searchBuffet').value.toLowerCase();
            // Show products that are NOT gift sets
            const items = products.filter(p => p.badge !== 'gift' && (!txt || p.name.toLowerCase().includes(txt)));
            
            if(items.length === 0) { div.innerHTML="<div class='col-12 text-center py-5'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</div>"; return; }

            items.forEach(p => {
                let isSel = buffetSelection.find(x=>x.id===p.id);
                div.innerHTML += `
                <div class="col-4 col-md-3 mb-2 px-1">
                    <div class="buffet-item p-2 h-100 ${isSel?'selected':''}" onclick="toggleBuf('${p.id}')">
                        <img src="${p.image}" class="w-100 rounded mb-1">
                        <div class="small text-truncate">${p.name}</div>
                        <div class="fw-bold text-danger small">${p.price}.-</div>
                    </div>
                </div>`;
            });
        }
        function toggleBuf(id) {
            let p = products.find(x=>x.id===id);
            let idx = buffetSelection.findIndex(x=>x.id===id);
            if(idx > -1) buffetSelection.splice(idx,1); else buffetSelection.push(p);
            renderBuffetList(); updateBuffetStat();
        }
        function updateBuffetStat() {
            let total = buffetSelection.reduce((s,i)=>s+Number(i.price),0);
            let limit = Number(currentBuffet.credit || 1500);
            document.getElementById('buffetCurrentTotal').innerText = total;
            let pct = (total/limit)*100;
            document.getElementById('buffetProgressBar').style.width = Math.min(pct,100) + "%";
            document.getElementById('buffetProgressBar').className = total>limit ? "progress-bar bg-danger" : "progress-bar bg-success";
            document.getElementById('btnFinishBuffet').disabled = (total==0 || total>limit);
            document.getElementById('buffetWarning').innerText = total>limit ? `‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö ${total-limit}` : "";
        }
        function finishBuffet() {
            let item = { ...currentBuffet, id: currentBuffet.id+'_'+Date.now(), isBuffet: true, buffetItems: buffetSelection, message: document.getElementById('buffetCardMsg').value, qty: 1 };
            cart.push(item); updateCartBadge();
            bootstrap.Modal.getInstance(document.getElementById('buffetModal')).hide(); openCart();
        }

        // --- Admin & Config ---
        function toggleAdmin() { if(prompt("‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô")==="1234") { document.getElementById('adminPanel').style.display='block'; window.scrollTo(0,document.body.scrollHeight); } }
        function toggleAdminMin() { const p = document.getElementById('adminPanel'); p.classList.toggle('minimized'); }
        function loadConfig() { 
            db.collection("settings").doc("shop").onSnapshot(d => { 
                if(d.exists) { 
                    shopConfig = d.data(); 
                    document.getElementById('navShopName').innerText = shopConfig.name || "‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà";
                    document.getElementById('shopBankInfo').innerText = shopConfig.payment || "‡∏£‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ";
                    document.getElementById('bankInfoText').innerText = shopConfig.payment || "-";
                    // Admin Inputs
                    document.getElementById('conf_name').value = shopConfig.name;
                    document.getElementById('conf_payment').value = shopConfig.payment;
                    document.getElementById('conf_line_id').value = shopConfig.lineId;
                    document.getElementById('conf_fb').value = shopConfig.fb;
                    document.getElementById('conf_ig').value = shopConfig.ig;
                    document.getElementById('conf_tiktok').value = shopConfig.tiktok;
                    
                    if(shopConfig.logo) { document.getElementById('navbarLogo').src = shopConfig.logo; document.getElementById('navbarLogo').style.display = 'block'; }
                    const lb = document.getElementById('btnLineContact'); if(shopConfig.lineId){lb.style.display='block'; lb.onclick=()=>window.open('https://line.me/ti/p/~'+shopConfig.lineId,'_blank');} else {lb.style.display='none';}
                    
                    const fs = document.getElementById('footerSocials'); fs.innerHTML = "";
                    if(shopConfig.fb) fs.innerHTML += `<a href="${shopConfig.fb}" target="_blank" class="text-secondary fs-4"><i class="fab fa-facebook"></i></a>`;
                    if(shopConfig.ig) fs.innerHTML += `<a href="${shopConfig.ig}" target="_blank" class="text-secondary fs-4"><i class="fab fa-instagram"></i></a>`;
                    if(shopConfig.tiktok) fs.innerHTML += `<a href="${shopConfig.tiktok}" target="_blank" class="text-secondary fs-4"><i class="fab fa-tiktok"></i></a>`;
                } 
            }); 
        }
        function saveShopConfig() {
            let d = {
                name: document.getElementById('conf_name').value,
                payment: document.getElementById('conf_payment').value,
                lineId: document.getElementById('conf_line_id').value,
                fb: document.getElementById('conf_fb').value,
                ig: document.getElementById('conf_ig').value,
                tiktok: document.getElementById('conf_tiktok').value
            };
            const logoUrl = document.getElementById('logo_url').value; if(logoUrl) d.logo = logoUrl;
            db.collection("settings").doc("shop").set(d, {merge:true}).then(()=>alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"));
        }
        function seedData() {
            if(!confirm("‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á?")) return;
            const items = [
                {name:"‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç '‡∏£‡∏±‡∏Å‡∏¢‡∏∑‡∏ô‡∏¢‡∏≤‡∏ß'", price:590, category:"‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç", badge:"gift", image:"https://images.unsplash.com/photo-1512909006721-3d6018887383?q=80&w=300&auto=format&fit=crop", credit:1500},
                {name:"‡∏¢‡∏≤‡∏î‡∏°‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£", price:45, category:"‡∏¢‡∏≤‡∏™‡∏≤‡∏°‡∏±‡∏ç", badge:"hot", image:"https://images.unsplash.com/photo-1626442674936-d47225c9939a?q=80&w=300&auto=format&fit=crop"},
                {name:"‡πÑ‡∏°‡πâ‡πÄ‡∏ó‡πâ‡∏≤‡∏û‡∏±‡∏ö‡πÑ‡∏î‡πâ", price:250, category:"‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå", badge:"recom", image:"https://images.unsplash.com/photo-1584646452292-62cb6e932333?q=80&w=300&auto=format&fit=crop"}
            ];
            items.forEach(i => db.collection("products").add(i));
            db.collection("categories").add({name:"‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç"});
            db.collection("categories").add({name:"‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå"});
            alert("‡πÄ‡∏™‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        }
        
        // --- Admin Product ---
        function renderAdminProducts() {
            const div = document.getElementById('adminProductList'); div.innerHTML = "";
            products.forEach(p => {
                div.innerHTML += `<div class="list-group-item d-flex justify-content-between align-items-center"><span>${p.name}</span><div><button class="btn btn-sm btn-warning me-1" onclick="editProduct('${p.id}')">‚úèÔ∏è</button><button class="btn btn-sm btn-outline-danger" onclick="db.collection('products').doc('${p.id}').delete()">üóëÔ∏è</button></div></div>`;
            });
        }
        function editProduct(id) {
            const p = products.find(x=>x.id===id); if(!p)return;
            document.getElementById('p_name').value=p.name;
            document.getElementById('p_price').value=p.price;
            document.getElementById('p_badge').value=p.badge;
            document.getElementById('p_category').value=p.category;
            document.getElementById('p_credit').value=p.credit;
            editId=id; 
            document.getElementById('editAlert').classList.remove('d-none');
            document.getElementById('adminPanel').classList.remove('minimized');
            document.getElementById('adminPanel').style.display='block';
        }
        function saveProduct() {
            let data = {
                name: document.getElementById('p_name').value,
                price: document.getElementById('p_price').value,
                badge: document.getElementById('p_badge').value,
                category: document.getElementById('p_category').value,
                image: document.getElementById('p_image').value || document.getElementById('p_base64_storage').value,
                credit: document.getElementById('p_credit').value
            };
            if(editId) db.collection("products").doc(editId).update(data).then(()=>alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß"));
            else db.collection("products").add(data).then(()=>alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß"));
            cancelEdit();
        }
        function cancelEdit() { editId=null; document.getElementById('editAlert').classList.add('d-none'); document.getElementById('p_name').value=""; }
        
        function loadCats() { 
            db.collection("categories").onSnapshot(s => { 
                const el = document.getElementById('p_category'); 
                const adminEl = document.getElementById('adminCatList');
                el.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î</option>"; 
                adminEl.innerHTML="";
                
                s.forEach(d=> {
                    let cat = d.data().name;
                    el.innerHTML+=`<option value='${cat}'>${cat}</option>`;
                    adminEl.innerHTML+=`<li class="list-group-item d-flex justify-content-between"><span>${cat}</span><button class="btn btn-sm btn-outline-danger" onclick="db.collection('categories').doc('${d.id}').delete()">‡∏•‡∏ö</button></li>`;
                }); 
            }); 
        }
        function addCategory() { 
            const n = document.getElementById('newCatName').value.trim(); 
            if(n) {
                db.collection("categories").add({name:n}).then(()=>{ 
                    alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏•‡πâ‡∏ß"); 
                    document.getElementById('newCatName').value="";
                });
            } else {
                 alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà");
            }
        }
        
        // Utils
        function searchProduct() { const t=document.getElementById('searchInput').value.toLowerCase(); renderAllProducts(products.filter(p=>p.name.toLowerCase().includes(t))); }
        function filterProducts(cat, btn) { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const h=document.getElementById('highlightZone'); const g=document.getElementById('giftSection'); if(cat==='all'){h.style.display='block'; g.style.display='block'; renderAllProducts(products);} else{h.style.display='none'; g.style.display='none'; renderAllProducts(products.filter(p=>(p.category||"").trim()===cat.trim()));} }
        function calcPrice() { let full = Number(document.getElementById('p_price_full').value)||0; let disc = Number(document.getElementById('p_discount').value)||0; document.getElementById('p_price').value = Math.floor(full - (full * disc / 100)); }
        
        function viewDetail(id) {
            let p = products.find(x=>x.id===id);
            document.getElementById('d_img').src = p.image;
            document.getElementById('d_name').innerText = p.name;
            document.getElementById('d_price').innerText = p.price + ".-";
            document.getElementById('d_desc').innerText = p.desc || "";
            document.getElementById('d_btn').onclick = () => { addToCart(id); bootstrap.Modal.getInstance(document.getElementById('productDetailModal')).hide(); };
            new bootstrap.Modal(document.getElementById('productDetailModal')).show(); 
        }
        async function previewImage(input) { if (input.files && input.files[0]) { try { const base64 = await resizeAndConvertToBase64(input.files[0]); document.getElementById('uploadZone').style.backgroundImage = `url(${base64})`; document.getElementById('p_base64_storage').value = base64; } catch(e) { alert("‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: " + e); } } }
        async function resizeAndConvertToBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = (event) => { const img = new Image(); img.src = event.target.result; img.onload = () => { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const maxWidth = 500; const scaleSize = maxWidth / img.width; canvas.width = maxWidth; canvas.height = img.height * scaleSize; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); resolve(canvas.toDataURL('image/jpeg', 0.6)); }; img.onerror = reject; }; }); }
    </script>
</body>
</html>