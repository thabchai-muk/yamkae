<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà - ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --pt-yellow: #F5DF4D; --pt-gray: #939597; --pt-dark: #333333; --pt-red: #dc3545; --pt-green: #198754; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; color: var(--pt-dark); padding-bottom: 80px; }
        .admin-only { display: none !important; } 
        .is-admin .admin-only { display: block !important; }
        .cursor-pointer { cursor: pointer; }
        .navbar { background: white; border-bottom: 4px solid var(--pt-yellow); padding: 10px 0; }
        .shop-logo-img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid var(--pt-yellow); margin-right: 10px; display: none; }
        .loader { display: flex; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:9999; justify-content:center; align-items:center; flex-direction: column; transition: opacity 0.5s; }
        .loader.hide { opacity: 0; pointer-events: none; }
        .carousel-item img { height: 450px; object-fit: cover; filter: brightness(0.95); }
        .cat-menu-container { overflow-x: auto; white-space: nowrap; padding: 15px 0 25px; text-align: center; position: sticky; top: 76px; z-index: 9; background: #f8f9fa; }
        .cat-btn { border: 1px solid #ddd; background: white; color: var(--pt-dark); border-radius: 50px; padding: 8px 25px; margin: 0 5px; font-weight: 600; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-btn.active, .cat-btn:hover { background: var(--pt-gray); color: var(--pt-yellow); border-color: var(--pt-gray); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .product-card { border: 1px solid #eee; border-radius: 12px; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; height: 100%; overflow: hidden; position: relative; cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); border-color: var(--pt-yellow); }
        .card-img-top { height: 200px; width: 100%; object-fit: contain; background: #fff; padding: 5px; }
        .badge-tag { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 30px; font-size: 0.75rem; color: white; font-weight: bold; text-transform: uppercase; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2; }
        .tag-gift { background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; } 
        .tag-hot { background: var(--pt-red); } .tag-new { background: var(--pt-green); } .tag-recom { background: #0d6efd; } .tag-promo { background: #6f42c1; color: white; }
        .checkout-card { background: white; padding: 20px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; }
        .cart-float { position: fixed; bottom: 30px; right: 30px; background: var(--pt-yellow); color: var(--pt-gray); width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(245, 223, 77, 0.6); cursor: pointer; z-index: 1000; border: 4px solid white; font-weight: bold; font-size: 1.5rem; transition: 0.3s; }
        .admin-panel { display: none; background: #fff; border-top: 5px solid var(--pt-yellow); padding: 30px; margin: 40px auto; border-radius: 10px; max-width: 900px; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); position: relative; }
        .admin-panel.minimized { height: 60px; overflow: hidden; padding: 10px 30px; bottom: 0; position: fixed; margin: 0; width: 100%; max-width: 100%; border-radius: 0; z-index: 9999; }
        .upload-box { border: 2px dashed var(--pt-gray); border-radius: 10px; padding: 20px; text-align: center; background: #f9f9f9; cursor: pointer; height: 150px; display: flex; flex-direction: column; justify-content: center; align-items: center; background-size: contain; background-repeat: no-repeat; background-position: center; overflow: hidden; }
        .gift-section { background-color: #fff9c4; padding: 40px 0; margin-bottom: 40px; border-bottom: 4px solid var(--pt-yellow); }
        .section-header { display: flex; align-items: center; margin-bottom: 20px; }
        .section-header h3 { font-weight: 800; color: var(--pt-gray); margin: 0; text-transform: uppercase; font-size: 1.5rem; }
        .section-line { flex-grow: 1; height: 2px; background: #eee; margin-left: 15px; }
        .blog-card { border: none; border-radius: 12px; overflow: hidden; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; h-100; border-left: 5px solid var(--pt-gray); cursor: pointer; }
        .blog-img { height: 200px; object-fit: cover; width: 100%; }
        .blog-content { padding: 25px; display: flex; flex-direction: column; height: 100%; }
        .buffet-item { cursor: pointer; border: 1px solid #eee; border-radius: 8px; overflow: hidden; transition: 0.2s; position: relative; background:white; }
        .buffet-item.selected { border: 2px solid var(--pt-green); background-color: #f0fff4; }
        .buffet-item.selected::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 5px; right: 5px; background: var(--pt-green); color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .buffet-progress { background: #fff3cd; border: 1px dashed #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: center; }
        .control-panel-sticky { position: sticky; top: 10px; height: calc(100vh - 100px); display: flex; flex-direction: column; overflow-y: auto; }
        .modal-footer-sticky { position: sticky; bottom: 0; background: white; padding: 15px; border-top: 1px solid #eee; z-index: 100; text-align: center; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        footer { background-color: #343a40; color: #adb5bd; padding-top: 3rem; padding-bottom: 1.5rem; margin-top: 4rem; }
        footer h5 { color: var(--pt-yellow); font-weight: bold; margin-bottom: 1.2rem; }
        footer a { color: #adb5bd; text-decoration: none; transition: 0.3s; }
        footer a:hover { color: var(--pt-yellow) !important; }
        footer .social-icon { font-size: 1.5rem; margin-right: 15px; color: #adb5bd; display: none; }
        footer .social-icon:hover { color: var(--pt-yellow); }
    </style>
</head>
<body id="body">

    <div id="loader" class="loader">
        <div class="spinner-border text-secondary"></div>
        <div class="mt-3 fw-bold text-secondary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    </div>

    <nav class="navbar sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="" id="navbarLogo" class="shop-logo-img">
                <div><div class="fs-5 fw-bold" id="navShopName" style="color:var(--pt-gray);">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</div><div style="font-size: 0.7rem; color: #999;">The Golden Age Selection</div></div>
            </a>
            <div class="d-flex align-items-center gap-2">
                <button id="btnLineContact" class="btn btn-sm btn-success rounded-pill px-3 shadow-sm"><i class="fab fa-line"></i> Line</button>
                <button class="btn btn-sm btn-outline-dark rounded-pill px-3 shadow-sm" onclick="openAboutModal()"><i class="fas fa-info-circle"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>
                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 shadow-sm" onclick="toggleAdmin()"><i class="fas fa-cog"></i></button>
            </div>
        </div>
    </nav>

    <div id="heroCarousel" class="carousel slide carousel-fade shadow-sm" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
            <div class="carousel-item"><img src="https://images.unsplash.com/photo-1511184150666-9eb715131de6?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
        </div>
    </div>

    <div class="gift-section shadow-sm" id="giftSection">
        <div class="container">
            <div class="text-center mb-4">
                <h2 class="fw-bold" style="color:var(--pt-gray)">üéÅ ‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏ó‡∏ô‡πÉ‡∏à</h2>
                <p class="text-muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏Ñ‡∏∏‡∏ì ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</p>
            </div>
            <div class="row g-4 justify-content-center px-3" id="listGift">
                <div class="col-12 text-center text-muted py-3 small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç...</div>
            </div>
        </div>
    </div>

    <div class="cat-menu-container shadow-sm" id="userCatFilter">
        <button class="cat-btn active" onclick="filterProducts('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div class="container mt-4" style="min-height: 60vh;">
        <div class="row justify-content-center mb-5"><div class="col-md-6"><input type="text" id="searchInput" class="form-control rounded-pill text-center shadow-sm" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="searchProduct()"></div></div>

        <div id="highlightZone">
            <div id="secHot" class="mb-5"><div class="section-header"><h3>üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3><div class="section-line"></div></div><div class="row g-4" id="listHot"><div class="col-12 text-center small text-muted">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div></div>
            <div id="secRecom" class="mb-5"><div class="section-header"><h3>‚≠ê ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><div class="section-line"></div></div><div class="row g-4" id="listRecom"><div class="col-12 text-center small text-muted">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div></div>
            <div id="secNew" class="mb-5"><div class="section-header"><h3>‚ú® ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</h3><div class="section-line"></div></div><div class="row g-4" id="listNew"><div class="col-12 text-center small text-muted">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div></div>
        </div>

        <div class="section-header mt-5"><h3>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3><div class="section-line"></div></div>
        <div class="row g-4" id="productList"><div class="col-12 text-center text-muted py-5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</div></div>
    </div>

    <div class="bg-white py-5 mt-5 border-top shadow-sm"><div class="container"><h3 class="fw-bold text-center mb-4 text-muted">üìñ ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ô‡πà‡∏≤‡∏£‡∏π‡πâ</h3><div class="row g-4 justify-content-center" id="listBlog"></div></div></div>

    <footer>
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <h5><i class="fas fa-store me-2"></i>‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</h5>
                    <p class="small">The Golden Age Selection - ‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏ß‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å</p>
                </div>
                <div class="col-md-4">
                    <h5>‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î</h5>
                    <ul class="list-unstyled small">
                        <li><a href="#"><i class="fas fa-chevron-right me-2 small"></i>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                        <li><a href="#giftSection"><i class="fas fa-chevron-right me-2 small"></i>‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</a></li>
                        <li><a href="javascript:void(0)" onclick="openAboutModal()"><i class="fas fa-chevron-right me-2 small"></i>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠/‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a></li>
                        <li><a href="javascript:void(0)" onclick="toggleAdmin()" class="text-muted"><i class="fas fa-cog me-2 small"></i>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏≤</h5>
                    <div class="mb-3">
                        <a href="#" id="linkFb" class="social-icon" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="#" id="linkIg" class="social-icon" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="#" id="linkTiktok" class="social-icon" target="_blank"><i class="fab fa-tiktok"></i></a>
                    </div>
                    <p class="small mb-0"><i class="fas fa-phone-alt me-2 text-warning"></i> <span id="footerContact">-</span></p>
                </div>
            </div>
            <hr>
            <div class="text-center small">
                &copy; <span id="curYear">2023</span> ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà. All rights reserved.
            </div>
        </div>
    </footer>

    <div class="container pb-5">
        <div id="adminPanel" class="admin-panel shadow-lg">
            <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                <h4 class="text-dark fw-bold"><i class="fas fa-cogs"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h4>
                <div>
                    <button class="btn btn-sm btn-outline-danger fw-bold me-2 px-3" onclick="document.getElementById('adminPanel').style.display='none'">‚ùå ‡∏õ‡∏¥‡∏î / ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button>
                    <button class="btn btn-sm btn-outline-primary" onclick="toggleAdminMin()">[-] ‡∏¢‡πà‡∏≠</button>
                </div>
            </div>
            <ul class="nav nav-pills nav-fill mb-4 gap-3">
                <li class="nav-item"><button class="nav-link active bg-secondary text-white fw-bold" data-bs-toggle="tab" data-bs-target="#tab-orders">üìÑ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-product">üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-cat">üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-shop">üè† ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-orders">
                    <button class="btn btn-sm btn-info mb-2" onclick="loadOrders()"><i class="fas fa-sync"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <div id="adminOrderList"><div class="text-center py-5 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div></div>
                </div>
                
                <div class="tab-pane fade" id="tab-product">
                    <div id="editAlert" class="alert alert-warning d-none mb-3">
                        <i class="fas fa-edit"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤... 
                        <button class="btn btn-sm btn-light border float-end fw-bold" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="fw-bold small">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="text-danger">*</span></label>
                            <input type="text" id="p_name" class="form-control form-control-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≤‡∏î‡∏°‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£">
                        </div>
                        <div class="col-md-2">
                            <label class="fw-bold small">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°</label>
                            <input type="number" id="p_price_full" class="form-control form-control-sm" placeholder="0" oninput="calcPrice()">
                        </div>
                        <div class="col-md-2">
                            <label class="fw-bold small">‡∏•‡∏î %</label>
                            <input type="number" id="p_discount" class="form-control form-control-sm" placeholder="0" oninput="calcPrice()">
                        </div>
                        <div class="col-md-2">
                            <label class="fw-bold small text-success">‡∏Ç‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á</label>
                            <input type="number" id="p_price" class="form-control form-control-sm bg-light" readonly>
                        </div>

                        <div class="col-md-4">
                            <label class="fw-bold small text-primary">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="p_category" class="form-select form-select-sm">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label class="fw-bold small text-danger">‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö</label>
                            <select id="p_badge" class="form-select form-select-sm">
                                <option value="">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                <option value="gift">üéÅ Gift Set (Buffet - ‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á)</option>
                                <option value="hot">üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ (Hot)</option>
                                <option value="new">‚ú® ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà (New)</option>
                                <option value="recom">‚≠ê ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (Recommend)</option>
                            </select>
                        </div>

                        <div class="col-md-12">
                            <label class="fw-bold small">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <div class="upload-box py-1 position-relative" onclick="document.getElementById('p_file').click()" id="uploadZone" style="min-height: 120px;">
                                <div id="uploadText" class="text-muted">
                                    <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i><br>
                                    <small>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</small>
                                </div>
                                <input type="file" id="p_file" class="d-none" accept="image/*" onchange="previewImage(this)">
                                <button id="btnRemoveImg" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2 d-none" onclick="event.stopPropagation(); removeImage();">x</button>
                            </div>
                            <input type="hidden" id="p_image_url">
                        </div>

                        <div class="col-12">
                            <label class="fw-bold small">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Gift Set)</label>
                            <input type="number" id="p_credit" class="form-control form-control-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1500">
                            <small class="text-muted" style="font-size: 0.75rem;">*‡πÉ‡∏™‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Gift Set</small>
                        </div>
                        
                        <div class="col-12">
                            <label class="fw-bold small">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <textarea id="p_desc" class="form-control form-control-sm" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."></textarea>
                        </div>
                        
                        <div class="col-12">
                            <label class="fw-bold small">YouTube (‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå)</label>
                            <input type="text" id="p_video" class="form-control form-control-sm" placeholder="https://youtube.com/...">
                        </div>

                        <div class="col-12 mt-3">
                            <button id="saveBtn" onclick="saveProduct()" class="btn btn-warning w-100 fw-bold py-2 shadow-sm">
                                <i class="fas fa-save me-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </button>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold text-secondary m-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6>
                        </div>
                        <div class="list-group shadow-sm small" id="adminProductList" style="max-height:300px; overflow-y:auto;">
                            <div class="text-center py-4 text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-cat">
                    <label class="fw-bold small mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà:</label>
                    <div class="input-group mb-3">
                        <input type="text" id="newCatName" class="form-control form-control-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà...">
                        <button class="btn btn-success btn-sm fw-bold" onclick="addCategory()">+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                    <hr>
                    <label class="fw-bold small mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ:</label>
                    <ul class="list-group shadow-sm small" id="adminCatList"><li class="list-group-item text-center text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà...</li></ul>
                </div>

                <div class="tab-pane fade" id="tab-shop">
                    <div class="row g-2">
                        <div class="col-12"><label class="fw-bold small">‡πÇ‡∏•‡πÇ‡∏Å‡πâ (URL)</label><input type="text" id="logo_url" class="form-control form-control-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></div>
                        <div class="col-6"><input type="text" id="conf_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô"></div>
                        <div class="col-6"><input type="text" id="conf_line_id" class="form-control form-control-sm" placeholder="LINE ID"></div>
                        <div class="col-12"><input type="text" id="conf_desc" class="form-control form-control-sm" placeholder="‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢"></div>
                        <div class="col-6"><input type="text" id="conf_contact" class="form-control form-control-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"></div>
                        <div class="col-12"><textarea id="conf_payment" class="form-control form-control-sm" rows="2" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"></textarea></div>
                        <div class="col-12 border-top pt-2 mt-2"><label class="fw-bold small mb-1">Social Media (‡πÉ‡∏™‡πà‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÄ‡∏ï‡πá‡∏°)</label></div>
                        <div class="col-4"><input type="text" id="conf_fb" class="form-control form-control-sm" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå Facebook"></div>
                        <div class="col-4"><input type="text" id="conf_ig" class="form-control form-control-sm" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå Instagram"></div>
                        <div class="col-4"><input type="text" id="conf_tiktok" class="form-control form-control-sm" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå TikTok"></div>
                        <div class="col-12 mt-3"><button onclick="saveShopConfig()" class="btn btn-secondary w-100 btn-sm fw-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="aboutModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title fw-bold text-dark">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-4"><img id="aboutLogo" src="" class="rounded-circle border border-3 border-warning mb-3" style="width:100px;height:100px;object-fit:cover;display:none;"><h4 id="aboutName" class="fw-bold"></h4><p id="aboutDesc" class="text-muted"></p><hr><p class="mb-2"><i class="fas fa-phone-alt text-warning"></i> <span id="aboutPhone"></span></p><p class="mb-3"><i class="fab fa-line text-success"></i> <span id="aboutLine"></span></p><div class="d-flex justify-content-center gap-2" id="aboutSocials"></div><div class="alert alert-light border text-start small mt-3" id="aboutPayment"></div></div></div></div></div>
    <div class="modal fade" id="productDetailModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content border-0 rounded-4 overflow-hidden"><div class="modal-header border-0 position-absolute end-0 top-0 z-3"><button type="button" class="btn-close bg-white p-2 m-2 shadow-sm rounded-circle" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><div class="row g-0"><div class="col-md-6 bg-light d-flex align-items-center justify-content-center"><img id="detailImg" src="" class="img-fluid" style="max-height:400px;" onerror="this.src='https://via.placeholder.com/400?text=No+Image'"></div><div class="col-md-6 p-4 d-flex flex-column"><span id="detailCat" class="badge bg-secondary align-self-start mb-2"></span><h3 id="detailName" class="fw-bold mb-3"></h3><div id="detailPriceBox" class="mb-3"></div><p id="detailDesc" class="text-muted flex-grow-1 small" style="white-space: pre-line;"></p><div id="detailVideo" class="mb-3"></div><button id="detailAddBtn" class="btn btn-warning w-100 py-3 fw-bold text-dark shadow-sm rounded-pill mt-auto">‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></div></div></div></div></div></div>
    <div class="modal fade" id="buffetModal" tabindex="-1" data-bs-backdrop="static"><div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title fw-bold"><i class="fas fa-gift"></i> ‡∏à‡∏±‡∏î‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç: <span id="buffetName"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body bg-light p-0"><div class="row g-0"><div class="col-lg-8 p-3" style="max-height: 70vh; overflow-y: auto;"><div class="card border-0 shadow-sm mb-3 sticky-top" style="top:0; z-index:5;"><div class="card-body p-2"><div class="d-flex justify-content-between align-items-center mb-2"><small>‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï:</small> <span class="fw-bold text-primary" id="buffetTarget">0</span></div><input type="text" id="searchBuffet" class="form-control border-0" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á..." onkeyup="filterBuffetItems()"></div></div><div class="row g-2" id="buffetItemsList"></div></div><div class="col-lg-4 bg-white border-start p-0"><div class="control-panel-sticky p-3"><div class="buffet-progress"><div class="small fw-bold">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á</div><h3 class="fw-bold text-primary mb-0"><span id="buffetCurrentTotal">0</span> / <span id="buffetMaxTotal">0</span></h3><div class="progress mt-2" style="height: 10px;"><div id="buffetProgressBar" class="progress-bar bg-success" style="width: 0%"></div></div><div class="small text-danger mt-1 fw-bold" id="buffetWarning"></div></div><hr><div class="mb-3"><label class="fw-bold small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á</label><select id="buffetBoxStyle" class="form-select form-select-sm"><option value="‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° (‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á)</option><option value="‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ (‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á)</option><option value="‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ">ü™µ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ (‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à)</option></select></div><div class="mb-3"><label class="fw-bold small">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î</label><textarea id="buffetCardMsg" class="form-control form-control-sm" rows="3" placeholder="‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö..."></textarea></div></div><div class="modal-footer-sticky mt-auto"><button class="btn btn-success w-100 fw-bold py-3 shadow-sm" id="btnFinishBuffet" onclick="finishBuffet()" disabled><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</button></div></div></div></div></div></div></div></div>
    <div class="modal fade" id="cartModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-warning"><h5 class="modal-title fw-bold"><i class="fas fa-shopping-basket"></i> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body row g-3">
                    <div class="col-lg-7 border-end"><div class="checkout-card"><div class="checkout-header mt-2 text-warning fw-bold mb-3"><i class="fas fa-cubes"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div><div id="cartItemsContainer" style="max-height: 300px; overflow-y: auto;"></div></div></div>
                    <div class="col-lg-5"><div class="checkout-card bg-light"><div class="checkout-header fw-bold mb-3"><i class="fas fa-map-marker-alt"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</div><div class="row g-2 mb-3"><div class="col-6"><input type="text" id="cust_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div><div class="col-6"><input type="tel" id="cust_tel" class="form-control form-control-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"></div><div class="col-12"><textarea id="cust_addr" class="form-control form-control-sm" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á"></textarea></div></div><hr><label class="small fw-bold mb-1">üöö ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</label><div class="option-group d-flex gap-3"><div class="form-check"><input class="form-check-input" type="radio" name="shippingOpt" id="ship_ems" value="50" checked onchange="selectShipping(50)"><label class="form-check-label small" for="ship_ems">EMS (50.-)</label></div><div class="form-check"><input class="form-check-input" type="radio" name="shippingOpt" id="ship_free" value="0" onchange="selectShipping(0)"><label class="form-check-label small" for="ship_free">‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</label></div></div><label class="small fw-bold mb-1">üí∞ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label><div class="option-group d-flex gap-3 mb-2"><div class="form-check"><input class="form-check-input" type="radio" name="paymentOpt" id="pay_transfer" value="transfer" checked onchange="selectPayment('transfer')"><label class="form-check-label small" for="pay_transfer">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label></div><div class="form-check"><input class="form-check-input" type="radio" name="paymentOpt" id="pay_cod" value="cod" onchange="selectPayment('cod')"><label class="form-check-label small" for="pay_cod">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</label></div></div><div id="bankInfoArea" class="alert alert-white border small p-2 mb-2"><div id="shopBankInfo" class="mb-2 fw-bold text-dark"></div><label class="small text-muted">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</label><input type="file" id="cust_slip" class="form-control form-control-sm mt-1" accept="image/*"></div><div class="mt-3 pt-3 border-top"><div class="d-flex justify-content-between mb-1"><span>‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><span id="sumSubtotal">0.-</span></div><div class="d-flex justify-content-between mb-1"><span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span><span id="sumShipping">50.-</span></div><div class="d-flex justify-content-between fw-bold fs-5"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span id="sumTotal" class="text-danger">0.-</span></div></div><button class="btn btn-success w-100 py-3 mt-3 fw-bold shadow-sm" onclick="confirmOrderOnWeb()"><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button></div></div>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-float shadow-lg" onclick="openCart()"><i class="fas fa-shopping-basket"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white" id="cartCount">0</span></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        // ‡∏•‡∏ö Storage ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà Firestore ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô"
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAPeCIM3yiPXwBWUFZhKPvkeClgPlyb_YU",
            authDomain: "shopyamkae.firebaseapp.com",
            projectId: "shopyamkae",
            storageBucket: "shopyamkae.firebasestorage.app",
            messagingSenderId: "914541091094",
            appId: "1:914541091094:web:eabccc6bdcfb6e1c1fd837",
            measurementId: "G-V58D283B28"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Global Variables ---
        window.products = [];
        window.categories = [];
        window.orders = [];
        window.cart = [];
        window.editId = null;
        window.shopConfig = JSON.parse(localStorage.getItem('shopConfig')) || { name: "‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà", payment: "‡∏ò.‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ 123-4-56789-0", lineId: "", contact: "" };
        
        let shippingCost = 50;
        let selectedPayment = 'transfer';
        let currentBuffet = null;
        let buffetSelection = [];
        
        window.tempImageFile = null;

        // --- Start Up ---
        document.addEventListener('DOMContentLoaded', async function() {
            await Promise.all([loadProducts(), loadCategories()]);
            loadShopConfig();
            document.getElementById('loader').classList.add('hide');
            document.getElementById('curYear').innerText = new Date().getFullYear();
        });

        // --- Firebase Functions ---
        async function loadProducts() {
            try {
                const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);
                window.products = [];
                snapshot.forEach(doc => {
                    window.products.push({ id: doc.id, ...doc.data() });
                });
                updateAllProductUI();
            } catch (error) {
                console.error("Error loading products:", error);
            }
        }

        async function loadCategories() {
            try {
                const q = query(collection(db, "categories"), orderBy("name"));
                const snapshot = await getDocs(q);
                window.categories = [];
                snapshot.forEach(doc => window.categories.push({id: doc.id, ...doc.data()}));
                renderCategoryList();
            } catch (error) {
                console.error("Error loading categories:", error);
            }
        }

        window.loadOrders = function() {
            const div = document.getElementById('adminOrderList');
            div.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-warning"></div></div>';
            
            const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
            onSnapshot(q, (snapshot) => {
                div.innerHTML = "";
                if(snapshot.empty) { div.innerHTML = "<p class='text-center text-muted'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>"; return; }
                
                snapshot.forEach(doc => {
                    const o = doc.data();
                    let itemsHtml = ""; 
                    if(o.items) o.items.forEach(i => itemsHtml += `<li>${i.name} x${i.qty || 1}</li>`);
                    let slipHtml = o.slip ? `<a href="${o.slip}" target="_blank" class="btn btn-sm btn-info mt-2">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>` : `<span class="text-danger small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ</span>`;
                    
                    div.innerHTML += `
                    <div class="order-card p-3 border rounded mb-2 bg-light">
                        <div class="d-flex justify-content-between fw-bold">
                            <span>${o.customer.name} (${o.customer.tel})</span> 
                            <span class="small text-muted">${new Date(o.timestamp.seconds * 1000).toLocaleString()}</span>
                        </div>
                        <div class="small mb-2"><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> ${o.customer.address}</div>
                        <div class="small mb-2"><b>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</b> ${o.total} (${o.paymentMethod==='cod'?'‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á':'‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'})</div>
                        <ul class="small mb-2 ps-3 text-muted">${itemsHtml}</ul>
                        <div class="d-flex justify-content-between align-items-center">${slipHtml}</div>
                    </div>`;
                });
            }, (error) => {
                console.error("Error watching orders:", error);
                div.innerHTML = "<p class='text-danger text-center'>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡πÄ‡∏ä‡πá‡∏Ñ Firestore Rules)</p>";
            });
        }

        // 1. Image Preview (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Base64 ‡πÉ‡∏™‡πà Input Hidden ‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢)
        window.previewImage = function(input) {
            if (input.files && input.files[0]) {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå ‡∏ñ‡πâ‡∏≤‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                if(input.files[0].size > 1000000) { // 1MB
                    alert("‚ö†Ô∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1MB");
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const zone = document.getElementById('uploadZone');
                    zone.style.backgroundImage = `url(${e.target.result})`;
                    zone.style.backgroundSize = 'contain';
                    zone.style.backgroundRepeat = 'no-repeat';
                    zone.style.backgroundPosition = 'center';
                    document.getElementById('uploadText').style.display = 'none';
                    document.getElementById('btnRemoveImg').classList.remove('d-none');
                    
                    // üî• ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÉ‡∏ô Input Hidden ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ upload)
                    document.getElementById('p_image_url').value = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 2. Remove Image
        window.removeImage = function() {
            document.getElementById('p_file').value = "";
            const zone = document.getElementById('uploadZone');
            zone.style.backgroundImage = 'none';
            document.getElementById('uploadText').style.display = 'flex';
            document.getElementById('btnRemoveImg').classList.add('d-none');
            document.getElementById('p_image_url').value = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ
        }

        // 3. Price Calculation
        window.calcPrice = function() {
            let full = Number(document.getElementById('p_price_full').value) || 0;
            let disc = Number(document.getElementById('p_discount').value) || 0;
            if (full > 0) {
                let final = Math.floor(full - (full * disc / 100));
                document.getElementById('p_price').value = final;
            } else {
                document.getElementById('p_price').value = 0;
            }
        }

        // 4. Save Product (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô Storage)
        window.saveProduct = async function() {
            const btn = document.getElementById('saveBtn');
            const name = document.getElementById('p_name').value.trim();
            const price = Number(document.getElementById('p_price').value) || 0;

            if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");
            
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                // ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Hidden Input ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏õ‡πá‡∏ô Base64 ‡∏¢‡∏≤‡∏ß‡πÜ)
                let finalImageUrl = document.getElementById('p_image_url').value;

                const productData = {
                    name: name,
                    price: price,
                    price_full: Number(document.getElementById('p_price_full').value) || 0,
                    discount: Number(document.getElementById('p_discount').value) || 0,
                    category: document.getElementById('p_category').value || "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
                    badge: document.getElementById('p_badge').value || "",
                    desc: document.getElementById('p_desc').value || "",
                    video: document.getElementById('p_video').value || "",
                    credit: Number(document.getElementById('p_credit').value) || 0,
                    image: finalImageUrl,
                    updatedAt: new Date()
                };

                if (window.editId) {
                    await updateDoc(doc(db, "products", window.editId), productData);
                    alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                } else {
                    productData.createdAt = new Date();
                    await addDoc(collection(db, "products"), productData);
                    alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
                }

                cancelEdit(); 
                loadProducts(); 

            } catch (e) {
                console.error("Save Error:", e);
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏•‡∏≠‡∏î
                alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message + "\n\n(‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ Firestore Rules ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô true ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á)");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-save me-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
            }
        }

        // 5. Edit Mode
        window.editProduct = function(id) {
            const p = window.products.find(x => x.id === id);
            if (!p) return;

            window.editId = id;
            
            document.getElementById('p_name').value = p.name;
            document.getElementById('p_price').value = p.price;
            document.getElementById('p_price_full').value = p.price_full || "";
            document.getElementById('p_discount').value = p.discount || "";
            document.getElementById('p_category').value = p.category || "";
            document.getElementById('p_badge').value = p.badge || "";
            document.getElementById('p_desc').value = p.desc || "";
            document.getElementById('p_video').value = p.video || "";
            document.getElementById('p_credit').value = p.credit || "";
            
            // ‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
            document.getElementById('p_image_url').value = p.image || "";

            if (p.image) {
                const zone = document.getElementById('uploadZone');
                zone.style.backgroundImage = `url(${p.image})`;
                zone.style.backgroundSize = 'contain';
                zone.style.backgroundRepeat = 'no-repeat';
                zone.style.backgroundPosition = 'center';
                document.getElementById('uploadText').style.display = 'none';
                document.getElementById('btnRemoveImg').classList.remove('d-none');
            } else {
                const zone = document.getElementById('uploadZone');
                zone.style.backgroundImage = 'none';
                document.getElementById('uploadText').style.display = 'flex';
                document.getElementById('btnRemoveImg').classList.add('d-none');
            }

            document.getElementById('editAlert').classList.remove('d-none');
            const btn = document.getElementById('saveBtn');
            btn.classList.replace('btn-warning', 'btn-primary');
            btn.innerHTML = '<i class="fas fa-save me-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            
            document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
        }

        // 6. Cancel Edit
        window.cancelEdit = function() {
            window.editId = null;
            
            const ids = ['p_name', 'p_price', 'p_price_full', 'p_discount', 'p_category', 'p_badge', 'p_desc', 'p_video', 'p_credit', 'p_file', 'p_image_url'];
            ids.forEach(id => document.getElementById(id).value = "");

            const zone = document.getElementById('uploadZone');
            zone.style.backgroundImage = 'none';
            document.getElementById('uploadText').style.display = 'flex';
            document.getElementById('btnRemoveImg').classList.add('d-none');

            document.getElementById('editAlert').classList.add('d-none');
            const btn = document.getElementById('saveBtn');
            btn.classList.replace('btn-primary', 'btn-warning');
            btn.innerHTML = '<i class="fas fa-save me-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
        }

        window.deleteProduct = async function(id) {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?")) {
                try {
                    await deleteDoc(doc(db, "products", id));
                    loadProducts();
                } catch(e) { alert(e.message); }
            }
        }

        window.confirmOrderOnWeb = async function() {
            if(window.cart.length===0) return alert("‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á");
            const name = document.getElementById('cust_name').value;
            const tel = document.getElementById('cust_tel').value;
            const addr = document.getElementById('cust_addr').value;
            
            if(!name || !tel || !addr) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
            
            document.getElementById('loader').classList.remove('hide');

            let slipUrl = "";
            const slipFile = document.getElementById('cust_slip').files[0];
            
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô Base64 (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
            if(selectedPayment === 'transfer' && slipFile) {
                 const reader = new FileReader();
                 reader.readAsDataURL(slipFile);
                 reader.onload = async function () {
                     slipUrl = reader.result;
                     await submitOrder(name, tel, addr, slipUrl);
                 };
            } else {
                await submitOrder(name, tel, addr, "");
            }
        }
        
        async function submitOrder(name, tel, addr, slipUrl) {
            const totalStr = document.getElementById('sumTotal').innerText;
            const orderData = {
                customer: { name, tel, address: addr },
                items: window.cart,
                total: totalStr,
                shipping: shippingCost,
                paymentMethod: selectedPayment,
                slip: slipUrl,
                status: 'new',
                timestamp: new Date()
            };

            try {
                await addDoc(collection(db, "orders"), orderData);
                document.getElementById('loader').classList.add('hide');
                window.cart = [];
                updateCartUI();
                bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                
                if(confirm("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏•‡∏ô‡πå‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤?")) {
                    if(shopConfig.lineId) {
                        let msg = `‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\n‡∏Ñ‡∏∏‡∏ì: ${name}\n‡∏¢‡∏≠‡∏î: ${totalStr}\n‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n`;
                        orderData.items.forEach(i => msg += `- ${i.name} x${i.qty}\n`);
                        window.open(`https://line.me/ti/p/~${shopConfig.lineId}?text=${encodeURIComponent(msg)}`, '_blank');
                    }
                }
            } catch(e) {
                alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
                document.getElementById('loader').classList.add('hide');
            }
        }

        // --- Category Logic (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏° Edit/Delete) ---
        window.addCategory = async function() {
            const n = document.getElementById('newCatName').value.trim();
            if(n) {
                try {
                    await addDoc(collection(db, "categories"), { name: n });
                    document.getElementById('newCatName').value = "";
                    loadCategories();
                } catch(e) { alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ Rules): " + e.message); }
            }
        }

        window.deleteCategory = async function(id) {
            if(confirm("‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ?")) {
                try {
                    await deleteDoc(doc(db, "categories", id));
                    loadCategories();
                } catch(e) { alert(e.message); }
            }
        }

        window.editCategory = async function(id) {
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å array
            const cat = window.categories.find(c => c.id === id);
            if (!cat) return;

            const newName = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:", cat.name);
            if(newName && newName !== cat.name) {
                try {
                    await updateDoc(doc(db, "categories", id), { name: newName });
                    loadCategories();
                } catch(e) { alert(e.message); }
            }
        }

        window.renderCategoryList = function() {
            const nav = document.getElementById('userCatFilter'); 
            const sel = document.getElementById('p_category'); 
            const adminList = document.getElementById('adminCatList'); 
            
            nav.innerHTML = `<button class="cat-btn active" onclick="filterProducts('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`; 
            sel.innerHTML = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>`; 
            adminList.innerHTML = ""; 
            
            if(window.categories.length === 0) adminList.innerHTML = "<li class='list-group-item text-center text-muted'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</li>";
            
            window.categories.forEach((c) => {
                nav.innerHTML += `<button class="cat-btn" onclick="filterProducts('${c.name}', this)">${c.name}</button>`; 
                sel.innerHTML += `<option value="${c.name}">${c.name}</option>`; 
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Edit ‡πÅ‡∏•‡∏∞ Delete ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
                adminList.innerHTML += `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    ${c.name}
                    <div>
                        <button class="btn btn-sm btn-warning me-1" onclick="editCategory('${c.id}')"><i class="fas fa-pen"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCategory('${c.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                </li>`; 
            });
        }

        // --- Standard Logic ---
        window.updateAllProductUI = function() { distributeContent(window.products); renderAllProducts(window.products); renderAdminList(window.products); }
        window.distributeContent = function(list) { 
            const giftDiv = document.getElementById('listGift'); giftDiv.innerHTML = ""; 
            const hotDiv = document.getElementById('listHot'); hotDiv.innerHTML = ""; 
            const recomDiv = document.getElementById('listRecom'); recomDiv.innerHTML = ""; 
            const newDiv = document.getElementById('listNew'); newDiv.innerHTML = ""; 
            const blogDiv = document.getElementById('listBlog'); blogDiv.innerHTML = ""; 
            list.forEach(p => { 
                let card = createProductCard(p, p.badge == 'gift' ? 'col-lg-6' : 'col-lg-4'); 
                if(p.badge == 'gift') giftDiv.innerHTML += card; else if(p.badge == 'hot') hotDiv.innerHTML += card; else if(p.badge == 'recom') recomDiv.innerHTML += card; else if(p.badge == 'new') newDiv.innerHTML += card; 
                if(p.price === 0) { let vidBtn = p.video ? `<a href="${p.video}" target="_blank" class="btn btn-sm btn-danger rounded-pill w-100 mb-2">‡∏ä‡∏°‡∏Ñ‡∏•‡∏¥‡∏õ</a>` : ""; blogDiv.innerHTML += `<div class="col-md-4 mb-4"><div class="blog-card h-100" onclick="openDetail('${p.id}')"><img src="${p.image||'https://via.placeholder.com/300'}" class="blog-img"><div class="blog-content"><div class="fw-bold mb-2">${p.name}</div><p class="small text-muted text-truncate">${p.desc||""}</p><div class="mt-auto">${vidBtn}</div></div></div></div>`; } 
            }); 
        }
        window.createProductCard = function(p, colClass='col-lg-4') { 
            let img = p.image || "https://via.placeholder.com/300"; 
            let tag = ""; if(p.badge === 'gift') tag = '<span class="badge-tag tag-gift">üéÅ ‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á</span>'; else if(p.badge === 'hot') tag = '<span class="badge-tag tag-hot">üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</span>'; else if(p.badge === 'new') tag = '<span class="badge-tag tag-new">‚ú® ‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</span>'; else if(p.badge === 'recom') tag = '<span class="badge-tag tag-recom">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>'; 
            let cardClick = `openDetail('${p.id}')`; let btnAction = `addToCart('${p.id}')`; let btnText = "‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤"; 
            if(p.badge === 'gift') { cardClick = `openBuffetModal('${p.id}')`; btnAction = `openBuffetModal('${p.id}')`; btnText = "‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏•‡∏¢"; } 
            return `<div class="col-6 ${colClass} d-flex align-items-stretch"><div class="product-card w-100 d-flex flex-column" onclick="${cardClick}">${tag}<img src="${img}" class="card-img-top" onerror="this.src='https://via.placeholder.com/300?text=No+Image'"><div class="p-3 d-flex flex-column flex-grow-1"><span class="badge bg-light text-dark border mb-2 align-self-start">${p.category||"‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"}</span><h6 class="mb-2 fw-bold card-title-fixed">${p.name}</h6><div class="mt-auto"><div class="mb-2 text-danger fw-bold fs-5">${p.price.toLocaleString()}.-</div><button class="btn btn-warning btn-sm w-100 fw-bold rounded-pill shadow-sm" onclick="event.stopPropagation(); ${btnAction}">${btnText}</button></div></div></div></div>`; 
        }
        window.renderAllProducts = function(list) { const div = document.getElementById('productList'); div.innerHTML = ""; if(list.length===0){div.innerHTML='<div class="col-12 text-center text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</div>';return;} list.forEach(p => { if(p.price>0 && p.badge !== 'gift') div.innerHTML += createProductCard(p); }); }
        window.renderAdminList = function(list) { const div = document.getElementById('adminProductList'); div.innerHTML = ""; if(list.length === 0) { div.innerHTML = "<div class='text-center text-muted p-3'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>"; return; } list.forEach(p => { div.innerHTML += `<div class="list-group-item d-flex justify-content-between align-items-center"><div class="d-flex align-items-center"><img src="${p.image||'https://via.placeholder.com/50'}" style="width:40px;height:40px;object-fit:cover;margin-right:10px;border-radius:4px;"><span class="text-truncate" style="max-width:150px;">${p.name}</span> <span class="badge bg-secondary ms-2">${p.price}</span></div><div><button class="btn btn-sm btn-warning me-1" onclick="editProduct('${p.id}')"><i class="fas fa-pen"></i></button><button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('${p.id}')"><i class="fas fa-trash"></i></button></div></div>`; }); }
        
        window.addToCart = function(id) { const p=window.products.find(x=>x.id===id); let exist=window.cart.find(x=>x.id===id); if(exist){exist.qty++;}else{window.cart.push({...p,qty:1});} updateCartUI(); openCart(); }
        window.removeFromCart = function(i) { window.cart.splice(i,1); updateCartUI(); }
        window.selectShipping = function(cost) { shippingCost = parseInt(cost); calculateFinalTotal(parseFloat(document.getElementById('sumSubtotal').innerText.replace(/,/g,'')) || 0); }
        window.selectPayment = function(method) { selectedPayment = method; const bankInfo = document.getElementById('bankInfoArea'); if(method === 'cod') { bankInfo.style.display = 'none'; } else { bankInfo.style.display = 'block'; } }
        window.updateCartUI = function() { const container = document.getElementById('cartItemsContainer'); const badge = document.getElementById('cartCount'); container.innerHTML = ""; let subtotal = 0; let totalQty = 0; if (window.cart.length === 0) { container.innerHTML = `<div class="text-center text-muted py-5"><i class="fas fa-basket-shopping fa-3x mb-3"></i><br>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>`; } window.cart.forEach((item, index) => { totalQty += item.qty; let itemTotal = item.price * item.qty; subtotal += itemTotal; let detailsHtml = ''; if (item.isGiftSet) { let innerItems = item.items.map(i => `<small class="d-block text-muted">- ${i.name}</small>`).join(""); detailsHtml = `<div class="small text-primary mt-1"><i class="fas fa-gift"></i> ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á: ${item.box}</div><div class="ps-2 border-start my-1">${innerItems}</div>${item.message ? `<div class="small text-secondary fst-italic">"${item.message}"</div>` : ''}`; } container.innerHTML += `<div class="d-flex align-items-start border-bottom pb-2 mb-2"><img src="${item.image}" style="width:60px; height:60px; object-fit:cover; border-radius:5px;" class="me-3"><div class="flex-grow-1"><div class="d-flex justify-content-between"><h6 class="fw-bold mb-0 text-truncate" style="max-width: 200px;">${item.name}</h6><button class="btn btn-sm text-danger" onclick="removeFromCart(${index})"><i class="fas fa-trash"></i></button></div>${detailsHtml}<div class="d-flex justify-content-between align-items-center mt-2"><span class="small text-muted">‡∏£‡∏≤‡∏Ñ‡∏≤: ${item.price.toLocaleString()}.-</span><span class="fw-bold text-dark">x ${item.qty}</span></div></div></div>`; }); badge.innerText = totalQty; calculateFinalTotal(subtotal); }
        window.openCart = function() { updateCartUI(); var myModal=new bootstrap.Modal(document.getElementById('cartModal')); myModal.show(); }
        window.calculateFinalTotal = function(sub) { document.getElementById('sumSubtotal').innerText = sub.toLocaleString() + ".-"; document.getElementById('sumShipping').innerText = shippingCost===0?"‡∏ü‡∏£‡∏µ":shippingCost+".-"; document.getElementById('sumTotal').innerText = (sub+shippingCost).toLocaleString()+".-"; }
        
        window.openBuffetModal = function(id) { const p = window.products.find(x => x.id === id); if(!p) return; currentBuffet = p; buffetSelection = []; document.getElementById('buffetName').innerText = p.name; document.getElementById('buffetTarget').innerText = (p.credit || 1800).toLocaleString(); document.getElementById('buffetMaxTotal').innerText = (p.credit || 1800).toLocaleString(); renderBuffetItems(); updateBuffetUI(); var m = new bootstrap.Modal(document.getElementById('buffetModal')); m.show(); }
        window.renderBuffetItems = function() { const container = document.getElementById('buffetItemsList'); container.innerHTML = ""; const searchTerm = document.getElementById('searchBuffet').value.toLowerCase(); window.products.forEach(p => { if(p.badge === 'gift') return; if(searchTerm && !p.name.toLowerCase().includes(searchTerm)) return; const isSelected = buffetSelection.find(x => x.id === p.id); const activeClass = isSelected ? 'selected' : ''; const btnText = isSelected ? '<i class="fas fa-check"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß' : '+ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'; const btnColor = isSelected ? 'btn-success' : 'btn-outline-primary'; container.innerHTML += `<div class="col-md-4 col-6"><div class="buffet-item p-2 rounded h-100 ${activeClass}" onclick="toggleBuffetItem('${p.id}')"><img src="${p.image}" class="w-100 rounded mb-2" style="height:80px; object-fit:cover;"><div class="small fw-bold text-truncate">${p.name}</div><div class="d-flex justify-content-between align-items-center mt-2"><span class="text-danger small fw-bold">${p.price}.-</span><button class="btn btn-sm ${btnColor} py-0 px-2 small">${btnText}</button></div></div></div>`; }); }
        window.toggleBuffetItem = function(id) { const p = window.products.find(x => x.id === id); const index = buffetSelection.findIndex(x => x.id === id); if(index > -1) { buffetSelection.splice(index, 1); } else { buffetSelection.push(p); } updateBuffetUI(); renderBuffetItems(); }
        window.updateBuffetUI = function() { const limit = parseInt(currentBuffet.credit || 1800); const currentTotal = buffetSelection.reduce((sum, item) => sum + item.price, 0); document.getElementById('buffetCurrentTotal').innerText = currentTotal.toLocaleString(); const percent = Math.min((currentTotal / limit) * 100, 100); const bar = document.getElementById('buffetProgressBar'); bar.style.width = percent + "%"; const btn = document.getElementById('btnFinishBuffet'); const warn = document.getElementById('buffetWarning'); if(currentTotal > limit) { bar.classList.add('bg-danger'); bar.classList.remove('bg-success'); warn.innerText = `‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö‡πÑ‡∏õ ${(currentTotal - limit).toLocaleString()} ‡∏ö‡∏≤‡∏ó!`; btn.disabled = true; } else { bar.classList.add('bg-success'); bar.classList.remove('bg-danger'); if(currentTotal === 0) { warn.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"; btn.disabled = true; } else { warn.innerText = ""; btn.disabled = false; } } }
        window.finishBuffet = function() { const boxStyle = document.getElementById('buffetBoxStyle').value; const cardMsg = document.getElementById('buffetCardMsg').value; const cartItem = { id: currentBuffet.id + "_" + Date.now(), name: currentBuffet.name, price: currentBuffet.price, image: currentBuffet.image, isGiftSet: true, items: buffetSelection, box: boxStyle, message: cardMsg, qty: 1 }; window.cart.push(cartItem); updateCartUI(); var m = bootstrap.Modal.getInstance(document.getElementById('buffetModal')); m.hide(); openCart(); }
        
        window.toggleAdmin = function() { const p=prompt("‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô:"); if(p==="1234") { document.getElementById('adminPanel').style.display="block"; document.getElementById('body').classList.add('is-admin'); document.getElementById('adminPanel').scrollIntoView(); loadOrders(); } }
        window.toggleAdminMin = function() { document.getElementById('adminPanel').classList.toggle('minimized'); }
        
        window.searchProduct = function() { const t=document.getElementById('searchInput').value.toLowerCase(); renderAllProducts(window.products.filter(p=>p.name.toLowerCase().includes(t))); }
        
        window.openAboutModal = function() { document.getElementById('aboutName').innerText=shopConfig.name; document.getElementById('aboutDesc').innerText=shopConfig.desc || "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö"; document.getElementById('aboutPhone').innerText=shopConfig.contact || "-"; document.getElementById('aboutLine').innerText=shopConfig.lineId || "-"; document.getElementById('aboutPayment').innerText=shopConfig.payment; if(shopConfig.logo){document.getElementById('aboutLogo').src=shopConfig.logo;document.getElementById('aboutLogo').style.display='inline-block';} var m=new bootstrap.Modal(document.getElementById('aboutModal')); m.show(); }
        window.filterProducts = function(cat, btn) { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const h=document.getElementById('highlightZone'); const g=document.getElementById('giftSection'); if(cat==='all'){h.style.display='block'; g.style.display='block'; renderAllProducts(window.products);} else{h.style.display='none'; g.style.display='none'; renderAllProducts(window.products.filter(p=>(p.category||"").trim()===cat.trim()));} }
        window.openDetail = function(id) { const p=window.products.find(x=>x.id===id); if(!p)return; document.getElementById('detailImg').src=p.image||"https://via.placeholder.com/300"; document.getElementById('detailName').innerText=p.name; document.getElementById('detailCat').innerText=p.category||"‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"; let pr=p.price.toLocaleString()+" ‡∏ö‡∏≤‡∏ó"; if(p.badge==='gift'||p.badge==='promo') pr="‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô"; else if(p.price_full>p.price) pr=`<s class="text-muted me-2">${p.price_full}</s> <span class="text-danger fs-3 fw-bold">${p.price}.-</span>`; document.getElementById('detailPriceBox').innerHTML=pr; document.getElementById('detailDesc').innerText=p.desc||""; document.getElementById('detailVideo').innerHTML=p.video?`<div class="ratio ratio-16x9"><iframe src="${p.video.replace('watch?v=','embed/')}" allowfullscreen></iframe></div>`:""; const btn=document.getElementById('detailAddBtn'); if(p.price===0){btn.style.display='none';} else{ btn.style.display='block'; btn.onclick=function(){addToCart(id); var m=bootstrap.Modal.getInstance(document.getElementById('productDetailModal')); m.hide();}; } var m=new bootstrap.Modal(document.getElementById('productDetailModal')); m.show(); }

        window.loadShopConfig = function() {
            document.getElementById('navShopName').innerText = shopConfig.name; document.getElementById('shopBankInfo').innerText = shopConfig.payment; document.getElementById('footerContact').innerText = shopConfig.contact || "-";
            document.getElementById('conf_name').value = shopConfig.name; document.getElementById('conf_payment').value = shopConfig.payment; document.getElementById('conf_line_id').value = shopConfig.lineId || ""; document.getElementById('conf_contact').value = shopConfig.contact || ""; document.getElementById('conf_desc').value = shopConfig.desc || "";
            document.getElementById('conf_fb').value = shopConfig.fb || ""; document.getElementById('conf_ig').value = shopConfig.ig || ""; document.getElementById('conf_tiktok').value = shopConfig.tiktok || "";
            if(shopConfig.logo) { document.getElementById('navbarLogo').src = shopConfig.logo; document.getElementById('navbarLogo').style.display = 'block'; }
            const lineBtn = document.getElementById('btnLineContact'); if(shopConfig.lineId) { lineBtn.style.display = 'block'; lineBtn.onclick = () => window.open('https://line.me/ti/p/~' + shopConfig.lineId, '_blank'); } else { lineBtn.style.display = 'none'; }
            updateSocialLink('linkFb', shopConfig.fb); updateSocialLink('linkIg', shopConfig.ig); updateSocialLink('linkTiktok', shopConfig.tiktok);
        }
        window.saveShopConfig = function() {
            shopConfig.name = document.getElementById('conf_name').value; shopConfig.desc = document.getElementById('conf_desc').value; shopConfig.contact = document.getElementById('conf_contact').value; shopConfig.payment = document.getElementById('conf_payment').value; shopConfig.lineId = document.getElementById('conf_line_id').value;
            shopConfig.fb = document.getElementById('conf_fb').value; shopConfig.ig = document.getElementById('conf_ig').value; shopConfig.tiktok = document.getElementById('conf_tiktok').value;
            const logoUrl = document.getElementById('logo_url').value; if(logoUrl) shopConfig.logo = logoUrl;
            localStorage.setItem('shopConfig', JSON.stringify(shopConfig)); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•)"); loadShopConfig();
        }
        window.updateSocialLink = function(elId, url) { const el = document.getElementById(elId); if(url) { el.href = url; el.style.display = 'inline-block'; } else { el.style.display = 'none'; } const container = document.getElementById('aboutSocials'); if(elId === 'linkFb') container.innerHTML = ''; if (url) { let iconClass = elId === 'linkFb' ? 'fa-facebook' : (elId === 'linkIg' ? 'fa-instagram' : 'fa-tiktok'); let btnColor = elId === 'linkFb' ? 'btn-primary' : (elId === 'linkIg' ? 'btn-danger' : 'btn-dark'); let btnText = elId === 'linkFb' ? 'Facebook' : (elId === 'linkIg' ? 'Instagram' : 'TikTok'); container.innerHTML += `<a href="${url}" target="_blank" class="btn ${btnColor} btn-sm"><i class="fab ${iconClass}"></i> ${btnText}</a>`; } }

    </script>
</body>
</html>