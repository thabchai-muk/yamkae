<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà - The Golden Age Selection</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --pt-yellow: #F5DF4D; --pt-gray: #939597; --pt-dark: #333333; --pt-red: #dc3545; --pt-green: #198754; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; color: var(--pt-dark); padding-bottom: 80px; }
        
        /* Helper Classes */
        .admin-only { display: none !important; } 
        .is-admin .admin-only { display: block !important; }
        .cursor-pointer { cursor: pointer; }

        /* Navbar & Loader */
        .navbar { background: white; border-bottom: 4px solid var(--pt-yellow); padding: 10px 0; }
        .shop-logo-img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid var(--pt-yellow); margin-right: 10px; display: none; }
        .loader { display: flex; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:9999; justify-content:center; align-items:center; flex-direction: column; transition: opacity 0.5s; }
        .loader.hide { opacity: 0; pointer-events: none; }

        /* Carousel */
        .carousel-item img { height: 450px; object-fit: cover; filter: brightness(0.95); }

        /* Gift Section (Animation) */
        .gift-section { background: linear-gradient(135deg, #fff9c4 0%, #fff3e0 100%); padding: 60px 0; position: relative; overflow: hidden; }
        .gift-section::before { content: '\f06b'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: -20px; right: -20px; font-size: 15rem; color: rgba(245, 223, 77, 0.15); z-index: 0; transform: rotate(-15deg); }
        .gift-header-animate { display: inline-block; animation: float-gift 3s ease-in-out infinite; background: white; padding: 15px 40px; border-radius: 50px; box-shadow: 0 10px 25px rgba(245, 223, 77, 0.4); border: 3px solid var(--pt-yellow); position: relative; z-index: 1; }
        @keyframes float-gift { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-5px) rotate(2deg); } }

        /* Product Card */
        .product-card { border: 1px solid #eee; border-radius: 12px; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden; height: 100%; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); border-color: var(--pt-yellow); }
        .card-img-top { height: 200px; width: 100%; object-fit: contain; background: #fff; padding: 5px; }
        .badge-tag { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 30px; font-size: 0.75rem; color: white; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2; }
        .tag-gift { background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; } 
        .tag-hot { background: var(--pt-red); } .tag-new { background: var(--pt-green); } .tag-recom { background: #0d6efd; }

        /* Category & Cart */
        .cat-menu-container { overflow-x: auto; white-space: nowrap; padding: 15px 0 25px; text-align: center; position: sticky; top: 76px; z-index: 9; background: #f8f9fa; }
        .cat-btn { border: 1px solid #ddd; background: white; color: var(--pt-dark); border-radius: 50px; padding: 8px 25px; margin: 0 5px; font-weight: 600; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-btn.active, .cat-btn:hover { background: var(--pt-gray); color: var(--pt-yellow); border-color: var(--pt-gray); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .cart-float { position: fixed; bottom: 30px; right: 30px; background: var(--pt-yellow); color: var(--pt-gray); width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(245, 223, 77, 0.6); cursor: pointer; z-index: 1000; border: 4px solid white; font-weight: bold; font-size: 1.5rem; transition: 0.3s; }

        /* Buffet Item Style */
        .buffet-item { cursor: pointer; border: 1px solid #eee; border-radius: 8px; overflow: hidden; position: relative; background:white; transition: 0.2s; }
        .buffet-item:hover { border-color: var(--pt-yellow); transform: scale(1.02); }
        .buffet-item.selected { border: 2px solid var(--pt-green); background-color: #f0fff4; }
        .buffet-item.selected::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 5px; right: 5px; background: var(--pt-green); color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }

        /* Admin & Others */
        .admin-panel { display: none; background: #fff; border-top: 5px solid var(--pt-yellow); padding: 30px; margin: 40px auto; border-radius: 10px; max-width: 900px; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); position: relative; }
        .admin-panel.minimized { height: 60px; overflow: hidden; padding: 10px 30px; bottom: 0; position: fixed; margin: 0; width: 100%; max-width: 100%; border-radius: 0; z-index: 9999; }
        .upload-box { border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer; background: #f9f9f9; height: 150px; display: flex; align-items: center; justify-content: center; background-size: contain; background-repeat: no-repeat; background-position: center; }

        /* Footer */
        footer { background-color: #343a40; color: #adb5bd; padding-top: 3rem; padding-bottom: 1.5rem; margin-top: 4rem; }
        footer h5 { color: var(--pt-yellow); font-weight: bold; margin-bottom: 1.2rem; }
        footer a { color: #adb5bd; text-decoration: none; transition: 0.3s; }
        footer a:hover { color: var(--pt-yellow); }
        footer .social-icon { font-size: 1.5rem; margin-right: 15px; color: #adb5bd; display: none; }
    </style>
</head>
<body id="body">

    <div id="loader" class="loader">
        <div class="spinner-border text-secondary"></div>
        <div class="mt-3 fw-bold text-secondary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤...</div>
        <button class="btn btn-sm btn-danger mt-3 px-4 rounded-pill shadow" onclick="document.getElementById('loader').classList.add('hide')">‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
    </div>

    <nav class="navbar sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="" id="navbarLogo" class="shop-logo-img">
                <div><div class="fs-5 fw-bold" id="navShopName">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</div><div style="font-size: 0.7rem; color: #999;">The Golden Age Selection</div></div>
            </a>
            <div class="d-flex align-items-center gap-2">
                <button id="btnLineContact" class="btn btn-sm btn-success rounded-pill px-3 shadow-sm" style="display:none;"><i class="fab fa-line"></i> Line</button>
                <button class="btn btn-sm btn-outline-dark rounded-pill px-3 shadow-sm" onclick="openAboutModal()"><i class="fas fa-info-circle"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>
                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 shadow-sm" onclick="toggleAdmin()"><i class="fas fa-cog"></i></button>
            </div>
        </div>
    </nav>

    <div id="heroCarousel" class="carousel slide carousel-fade shadow-sm" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
            <div class="carousel-item"><img src="https://images.unsplash.com/photo-1511184150666-9eb715131de6?q=80&w=1470&auto=format&fit=crop" class="d-block w-100"></div>
        </div>
    </div>

    <div class="gift-section shadow-sm" id="giftSection">
        <div class="container position-relative" style="z-index: 1;">
            <div class="text-center mb-5">
                <div class="gift-header-animate mb-3">
                    <h2 class="fw-bold m-0" style="color:#5d4037"><i class="fas fa-gift me-2 text-warning"></i>‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÅ‡∏ó‡∏ô‡πÉ‡∏à</h2>
                </div>
                <p class="text-muted fs-5">"‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å...‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ"</p>
                <p class="small text-secondary">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏Ñ‡∏∏‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤</p>
            </div>
            <div class="row g-4 justify-content-center px-3" id="listGift">
                <div class="col-12 text-center text-muted py-3 small">
                    <div class="spinner-border text-warning" role="status"></div><div class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="cat-menu-container shadow-sm" id="userCatFilter">
        <button class="cat-btn active" onclick="filterProducts('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div class="container mt-4" style="min-height: 60vh;">
        <div class="row justify-content-center mb-5"><div class="col-md-6"><input type="text" id="searchInput" class="form-control rounded-pill text-center shadow-sm" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="searchProduct()"></div></div>

        <div id="highlightZone">
            <div id="secHot" class="mb-5"><div class="d-flex align-items-center mb-3"><h3 class="fw-bold m-0">üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div><div class="row g-4" id="listHot"></div></div>
            <div id="secRecom" class="mb-5"><div class="d-flex align-items-center mb-3"><h3 class="fw-bold m-0">‚≠ê ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div><div class="row g-4" id="listRecom"></div></div>
            <div id="secNew" class="mb-5"><div class="d-flex align-items-center mb-3"><h3 class="fw-bold m-0">‚ú® ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div><div class="row g-4" id="listNew"></div></div>
        </div>

        <div class="d-flex align-items-center mb-3 mt-5"><h3 class="fw-bold m-0">üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3><div class="flex-grow-1 bg-light ms-3" style="height:2px;"></div></div>
        <div class="row g-4" id="productList">
            <div class="col-12 text-center text-muted py-5"><div class="spinner-border text-secondary"></div></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <h5 class="text-warning">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà</h5>
                    <p class="small">‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏ß‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏Å ‡∏°‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</p>
                </div>
                <div class="col-md-4">
                    <h5 class="text-warning">‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î</h5>
                    <ul class="list-unstyled small">
                        <li><a href="#">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                        <li><a href="#giftSection">‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</a></li>
                        <li><a href="javascript:void(0)" onclick="openAboutModal()">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a></li>
                        <li><a href="javascript:void(0)" onclick="toggleAdmin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 class="text-warning">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏≤</h5>
                    <div class="mb-3">
                        <a href="#" id="linkFb" class="social-icon" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="#" id="linkIg" class="social-icon" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="#" id="linkTiktok" class="social-icon" target="_blank"><i class="fab fa-tiktok"></i></a>
                    </div>
                    <p class="small mb-0"><i class="fas fa-phone-alt me-2 text-warning"></i> <span id="footerContact">-</span></p>
                </div>
            </div>
            <hr>
            <div class="text-center small">&copy; <span id="curYear"></span> ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà. All rights reserved.</div>
        </div>
    </footer>

    <div class="container pb-5">
        <div id="adminPanel" class="admin-panel shadow-lg">
            <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                <h4 class="text-dark fw-bold">‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h4>
                <div>
                    <button class="btn btn-sm btn-success fw-bold me-2 px-3" onclick="seedData()">‚ú® ‡πÄ‡∏™‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
                    <button class="btn btn-sm btn-outline-danger fw-bold me-2 px-3" onclick="document.getElementById('adminPanel').style.display='none'">‚ùå ‡∏õ‡∏¥‡∏î</button>
                    <button class="btn btn-sm btn-outline-primary" onclick="toggleAdminMin()">[-]</button>
                </div>
            </div>
            <ul class="nav nav-pills nav-fill mb-4 gap-3">
                <li class="nav-item"><button class="nav-link active bg-secondary text-white" data-bs-toggle="tab" data-bs-target="#tab-orders">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-product">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-cat">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button></li>
                <li class="nav-item"><button class="nav-link bg-light text-dark border" data-bs-toggle="tab" data-bs-target="#tab-shop">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-orders"><div id="adminOrderList" class="text-center py-5 text-muted">...</div></div>
                <div class="tab-pane fade" id="tab-product">
                    <div id="editAlert" class="alert alert-warning d-none">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç... <button class="btn btn-sm btn-light float-end" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div>
                    <div class="row g-2">
                        <div class="col-6"><input type="text" id="p_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"></div>
                        <div class="col-3"><input type="number" id="p_price" class="form-control form-control-sm" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" oninput="calcPrice()"></div>
                        <div class="col-3"><input type="number" id="p_price_full" class="form-control form-control-sm" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°" oninput="calcPrice()"></div>
                        <div class="col-4"><select id="p_category" class="form-select form-select-sm"><option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option></select></div>
                        <div class="col-4"><select id="p_badge" class="form-select form-select-sm"><option value="">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="gift">üéÅ Gift Set</option><option value="hot">üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</option><option value="recom">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option></select></div>
                        <div class="col-4"><input type="number" id="p_credit" class="form-control form-control-sm" placeholder="‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (Gift Set)"></div>
                        <div class="col-12"><textarea id="p_desc" class="form-control form-control-sm" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea></div>
                        <div class="col-12"><div class="upload-box" onclick="document.getElementById('p_file').click()" id="uploadZone"><small>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</small></div><input type="file" id="p_file" class="d-none" accept="image/*" onchange="previewImage(this)"><input type="hidden" id="p_base64_storage"></div>
                        <div class="col-12"><button onclick="saveProduct()" class="btn btn-warning w-100 btn-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                    </div>
                    <hr>
                    <div class="list-group small" id="adminProductList" style="max-height:250px; overflow-y:auto;"></div>
                </div>
                <div class="tab-pane fade" id="tab-cat">
                    <div class="input-group mb-3"><input type="text" id="newCatName" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î"><button class="btn btn-success btn-sm" onclick="addCategory()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button></div>
                    <ul class="list-group small" id="adminCatList"></ul>
                </div>
                <div class="tab-pane fade" id="tab-shop">
                    <div class="row g-2">
                        <div class="col-6"><input type="text" id="conf_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô"></div>
                        <div class="col-6"><input type="text" id="conf_line_id" class="form-control form-control-sm" placeholder="LINE ID"></div>
                        <div class="col-12"><input type="text" id="conf_desc" class="form-control form-control-sm" placeholder="‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢"></div>
                        <div class="col-6"><input type="text" id="conf_contact" class="form-control form-control-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"></div>
                        <div class="col-12"><textarea id="conf_payment" class="form-control form-control-sm" rows="2" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ"></textarea></div>
                        <div class="col-12 fw-bold small mt-2">Social Links:</div>
                        <div class="col-4"><input type="text" id="conf_fb" class="form-control form-control-sm" placeholder="Link Facebook"></div>
                        <div class="col-4"><input type="text" id="conf_ig" class="form-control form-control-sm" placeholder="Link IG"></div>
                        <div class="col-4"><input type="text" id="conf_tiktok" class="form-control form-control-sm" placeholder="Link TikTok"></div>
                        <div class="col-12 mt-2"><button onclick="saveShopConfig()" class="btn btn-secondary w-100 btn-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="aboutModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title fw-bold text-dark">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-4"><img id="aboutLogo" src="" class="rounded-circle border border-3 border-warning mb-3" style="width:100px;height:100px;object-fit:cover;display:none;"><h4 id="aboutName" class="fw-bold"></h4><p id="aboutDesc" class="text-muted"></p><hr><p class="mb-2"><i class="fas fa-phone-alt text-warning"></i> <span id="aboutPhone"></span></p><p class="mb-3"><i class="fab fa-line text-success"></i> <span id="aboutLine"></span></p><div class="d-flex justify-content-center gap-2" id="aboutSocials"></div><div class="alert alert-light border text-start small mt-3" id="aboutPayment"></div></div></div></div></div>
    
    <div class="modal fade" id="productDetailModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content border-0 rounded-4 overflow-hidden"><div class="modal-header border-0 position-absolute end-0 top-0 z-3"><button type="button" class="btn-close bg-white p-2 m-2 shadow-sm rounded-circle" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><div class="row g-0"><div class="col-md-6 bg-light d-flex align-items-center justify-content-center"><img id="detailImg" src="" class="img-fluid" style="max-height:400px;" onerror="this.src='https://via.placeholder.com/400?text=No+Image'"></div><div class="col-md-6 p-4 d-flex flex-column"><span id="detailCat" class="badge bg-secondary align-self-start mb-2"></span><h3 id="detailName" class="fw-bold mb-3"></h3><div id="detailPriceBox" class="mb-3"></div><p id="detailDesc" class="text-muted flex-grow-1 small" style="white-space: pre-line;"></p><div id="detailVideo" class="mb-3"></div><button id="detailAddBtn" class="btn btn-warning w-100 py-3 fw-bold text-dark shadow-sm rounded-pill mt-auto">‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></div></div></div></div></div></div>

    <div class="modal fade" id="buffetModal" tabindex="-1" data-bs-backdrop="static"><div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title fw-bold"><i class="fas fa-gift"></i> ‡∏à‡∏±‡∏î‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç: <span id="buffetName"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body bg-light p-0"><div class="row g-0"><div class="col-lg-8 p-3" style="max-height: 70vh; overflow-y: auto;"><div class="card border-0 shadow-sm mb-3 sticky-top" style="top:0; z-index:5;"><div class="card-body p-2"><div class="d-flex justify-content-between align-items-center mb-2"><small>‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï:</small> <span class="fw-bold text-primary" id="buffetTarget">0</span></div><input type="text" id="searchBuffet" class="form-control border-0" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á..." onkeyup="filterBuffetItems()"></div></div><div class="row g-2" id="buffetItemsList"></div></div><div class="col-lg-4 bg-white border-start p-0"><div class="control-panel-sticky p-3"><div class="buffet-progress"><div class="small fw-bold">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á</div><h3 class="fw-bold text-primary mb-0"><span id="buffetCurrentTotal">0</span> / <span id="buffetMaxTotal">0</span></h3><div class="progress mt-2" style="height: 10px;"><div id="buffetProgressBar" class="progress-bar bg-success" style="width: 0%"></div></div><div class="small text-danger mt-1 fw-bold" id="buffetWarning"></div></div><hr><div class="mb-3"><label class="fw-bold small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á</label><select id="buffetBoxStyle" class="form-select form-select-sm"><option value="‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° (‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏î‡∏á)</option><option value="‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á">üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ (‡πÇ‡∏ö‡∏ß‡πå‡∏ó‡∏≠‡∏á)</option><option value="‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ">ü™µ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ (‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à)</option></select></div><div class="mb-3"><label class="fw-bold small">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î</label><textarea id="buffetCardMsg" class="form-control form-control-sm" rows="3" placeholder="‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö..."></textarea></div></div><div class="modal-footer-sticky mt-auto"><button class="btn btn-success w-100 fw-bold py-3 shadow-sm" id="btnFinishBuffet" onclick="finishBuffet()" disabled><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</button></div></div></div></div></div></div></div>

    <div class="modal fade" id="cartModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title fw-bold"><i class="fas fa-shopping-basket"></i> ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body row g-3">
                    <div class="col-lg-7 border-end">
                        <div class="checkout-card">
                            <div class="checkout-header mt-2 text-warning fw-bold mb-3"><i class="fas fa-cubes"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                            <div id="cartItemsContainer" style="max-height: 300px; overflow-y: auto;"></div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="checkout-card bg-light">
                            <div class="checkout-header fw-bold mb-3"><i class="fas fa-map-marker-alt"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</div>
                            <div class="row g-2 mb-3">
                                <div class="col-6"><input type="text" id="cust_name" class="form-control form-control-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" required></div>
                                <div class="col-6"><input type="tel" id="cust_tel" class="form-control form-control-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" required></div>
                                <div class="col-12"><textarea id="cust_addr" class="form-control form-control-sm" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ö‡πâ‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö)" required></textarea></div>
                            </div>
                            <hr>
                            <label class="small fw-bold mb-1">üöö ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</label>
                            <div class="option-group d-flex gap-3">
                                <div class="form-check"><input class="form-check-input" type="radio" name="shippingOpt" id="ship_ems" value="50" checked onchange="selectShipping(50)"><label class="form-check-label small" for="ship_ems">EMS (50.-)</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="shippingOpt" id="ship_free" value="0" onchange="selectShipping(0)"><label class="form-check-label small" for="ship_free">‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</label></div>
                            </div>
                            <label class="small fw-bold mb-1">üí∞ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
                            <div class="option-group d-flex gap-3 mb-2">
                                <div class="form-check"><input class="form-check-input" type="radio" name="paymentOpt" id="pay_transfer" value="transfer" checked onchange="selectPayment('transfer')"><label class="form-check-label small" for="pay_transfer">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label></div>
                                <div class="form-check"><input class="form-check-input" type="radio" name="paymentOpt" id="pay_cod" value="cod" onchange="selectPayment('cod')"><label class="form-check-label small" for="pay_cod">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</label></div>
                            </div>
                            <div id="bankInfoArea" class="alert alert-white border small p-2 mb-2">
                                <div id="shopBankInfo" class="mb-2 fw-bold text-dark"></div>
                                <label class="small text-muted">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                                <input type="file" id="cust_slip" class="form-control form-control-sm mt-1" accept="image/*">
                            </div>
                            <div class="mt-3 pt-3 border-top">
                                <div class="d-flex justify-content-between mb-1"><span>‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><span id="sumSubtotal">0.-</span></div>
                                <div class="d-flex justify-content-between mb-1"><span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span><span id="sumShipping">50.-</span></div>
                                <div class="d-flex justify-content-between fw-bold fs-5"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span id="sumTotal" class="text-danger">0.-</span></div>
                            </div>
                            <button class="btn btn-success w-100 py-3 mt-3 fw-bold shadow-sm" onclick="confirmOrderOnWeb()"><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-float shadow-lg" onclick="openCart()"><i class="fas fa-shopping-basket"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white" id="cartCount">0</span></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBzfx5PBzXTJNDSznJgpkXlgcovGYdF4mE", authDomain: "yamkae-s.firebaseapp.com", projectId: "yamkae-s", storageBucket: "yamkae-s.firebasestorage.app", messagingSenderId: "826309769226", appId: "1:826309769226:web:f2ffd6252879c0155887f3", measurementId: "G-4EF58B2XYK" };
        let db; try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); } catch(e) { console.error(e); }

        let products=[], cart=[], categories=[], orders=[], shopConfig={}, editId=null, shippingCost=50, selectedPayment='transfer', currentBuffet=null, buffetSelection=[];

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => document.getElementById('loader').classList.add('hide'), 500);
            if(db) { 
                checkAndSeedData(); 
                loadConfig(); loadCategories(); loadProducts(); loadOrders(); 
            }
            document.getElementById('curYear').innerText = new Date().getFullYear();
        });

        // 1. Auto Seed (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á)
        function checkAndSeedData() {
            db.collection("products").get().then(snap => {
                if(snap.empty) {
                    const mockItems = [
                        { name: "‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç '‡∏£‡∏±‡∏Å‡∏¢‡∏∑‡∏ô‡∏¢‡∏≤‡∏ß'", price: 590, price_full: 790, category: "‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç", badge: "gift", image: "https://images.unsplash.com/photo-1512909006721-3d6018887383?q=80&w=1470&auto=format&fit=crop", desc: "‡∏ä‡∏∏‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏≤‡∏£‡πâ‡∏≠‡∏ô", credit: 1500 },
                        { name: "‡πÑ‡∏°‡πâ‡πÄ‡∏ó‡πâ‡∏≤‡∏û‡∏±‡∏ö‡πÑ‡∏î‡πâ ‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°", price: 250, price_full: 390, category: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå", badge: "hot", image: "https://images.unsplash.com/photo-1584646452292-62cb6e932333?q=80&w=1000&auto=format&fit=crop", desc: "‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏ö‡∏≤ ‡∏û‡∏Å‡∏û‡∏≤‡∏™‡∏∞‡∏î‡∏ß‡∏Å" },
                        { name: "‡∏¢‡∏≤‡∏î‡∏°‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏´‡∏°‡∏±‡∏Å", price: 120, price_full: 150, category: "‡∏¢‡∏≤‡∏™‡∏≤‡∏°‡∏±‡∏ç", badge: "recom", image: "https://images.unsplash.com/photo-1626442674936-d47225c9939a?q=80&w=1000&auto=format&fit=crop", desc: "‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏ô‡πÉ‡∏à" }
                    ];
                    mockItems.forEach(i => db.collection("products").add(i));
                    db.collection("categories").add({name: "‡∏ä‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç"});
                    db.collection("categories").add({name: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå"});
                    db.collection("categories").add({name: "‡∏¢‡∏≤‡∏™‡∏≤‡∏°‡∏±‡∏ç"});
                    setTimeout(() => location.reload(), 1500);
                }
            });
        }
        function seedData() { 
            if(confirm("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á?")) { 
                checkAndSeedData(); 
                alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π)"); 
            } 
        }

        // 2. Products & UI
        function loadProducts() {
            db.collection("products").onSnapshot(snap => {
                products = []; snap.forEach(d => { let p=d.data(); p.id=d.id; products.push(p); });
                renderFront(); renderAdminProducts();
            });
        }
        function renderFront() {
            const giftBox = document.getElementById('listGift'); giftBox.innerHTML = "";
            const prodBox = document.getElementById('productList'); prodBox.innerHTML = "";
            if(products.length === 0) return;

            products.forEach(p => {
                let tag = "";
                if(p.badge==='gift') tag='<span class="badge-tag tag-gift">üéÅ ‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏≠‡∏á</span>';
                else if(p.badge==='hot') tag='<span class="badge-tag tag-hot">üî• ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</span>';
                else if(p.badge==='new') tag='<span class="badge-tag tag-new">‚ú® ‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</span>';
                else if(p.badge==='recom') tag='<span class="badge-tag tag-recom">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>';

                // ‡πÅ‡∏¢‡∏Å Logic ‡∏õ‡∏∏‡πà‡∏°
                let cardAction = `openDetail('${p.id}')`; // ‡∏Å‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                let btnAction = `addToCart('${p.id}')`;    // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                let btnText = "‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤";
                
                if(p.badge==='gift') {
                    cardAction = `openBuffetModal('${p.id}')`;
                    btnAction = `openBuffetModal('${p.id}')`;
                    btnText = "‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï‡πÄ‡∏•‡∏¢";
                }

                const html = `
                <div class="col-6 col-lg-3 d-flex align-items-stretch">
                    <div class="product-card w-100" onclick="${cardAction}">
                        ${tag}
                        <img src="${p.image || 'https://via.placeholder.com/300'}" class="card-img-top">
                        <div class="p-3">
                            <small class="text-muted">${p.category||'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</small>
                            <h6 class="fw-bold text-truncate">${p.name}</h6>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="text-danger fw-bold">${Number(p.price).toLocaleString()}.-</span>
                                <button class="btn btn-sm btn-warning rounded-pill shadow-sm px-3" onclick="event.stopPropagation(); ${btnAction}">${btnText}</button>
                            </div>
                        </div>
                    </div>
                </div>`;
                
                if(p.badge==='gift') giftBox.innerHTML += html;
                else prodBox.innerHTML += html;
            });
        }

        // 3. Cart & Checkout (Fixed)
        function addToCart(id) {
            let p = products.find(x => x.id === id);
            let item = cart.find(x => x.id === id);
            if(item) item.qty++; else cart.push({...p, qty: 1});
            updateCartBadge(); openCart();
        }
        function updateCartBadge() { document.getElementById('cartCount').innerText = cart.reduce((s,i)=>s+i.qty,0); }
        function openCart() { renderCartItems(); calcTotal(); new bootstrap.Modal(document.getElementById('cartModal')).show(); }
        
        function renderCartItems() {
            const div = document.getElementById('cartItemsContainer'); div.innerHTML = "";
            if(cart.length===0) { div.innerHTML="<div class='text-center py-5 text-muted'>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>"; return; }
            cart.forEach((i, idx) => {
                let extra = i.isBuffet ? `<div class="small text-success ps-2 border-start">${i.buffetItems.map(b=>b.name).join(', ')}</div>` : '';
                div.innerHTML += `
                <div class="d-flex align-items-start border-bottom pb-2 mb-2">
                    <img src="${i.image}" width="50" class="rounded me-2">
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <span class="fw-bold small">${i.name}</span>
                            <i class="fas fa-times text-danger cursor-pointer" onclick="cart.splice(${idx},1); openCart(); updateCartBadge();"></i>
                        </div>
                        ${extra}
                        <div class="d-flex justify-content-between align-items-center mt-1">
                            <span class="text-muted small">${Number(i.price).toLocaleString()}.-</span>
                            <span class="fw-bold">x ${i.qty}</span>
                        </div>
                    </div>
                </div>`;
            });
        }
        
        function calcTotal() {
            shippingCost = parseInt(document.querySelector('input[name="shippingOpt"]:checked').value);
            let sub = cart.reduce((s,i)=>s+(i.price*i.qty),0);
            document.getElementById('sumSubtotal').innerText = sub.toLocaleString() + ".-";
            document.getElementById('sumShipping').innerText = shippingCost===0 ? "‡∏ü‡∏£‡∏µ" : shippingCost + ".-";
            document.getElementById('sumTotal').innerText = (sub + shippingCost).toLocaleString() + ".-";
            document.getElementById('finalPrice').innerText = (sub + shippingCost).toLocaleString() + ".-"; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile View
        }

        function selectShipping(val) { calcTotal(); }
        function selectPayment(val) {
            selectedPayment = val;
            document.getElementById('bankInfoArea').style.display = val === 'cod' ? 'none' : 'block';
        }

        async function confirmOrderOnWeb() {
            if(cart.length===0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
            const name = document.getElementById('cust_name').value;
            const tel = document.getElementById('cust_tel').value;
            const addr = document.getElementById('cust_addr').value;
            
            if(!name || !tel || !addr) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏ä‡∏∑‡πà‡∏≠ ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");

            document.getElementById('loader').classList.remove('hide');
            
            // Upload Slip (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            let slipUrl = "";
            const fileInput = document.getElementById('cust_slip');
            if(selectedPayment === 'transfer' && fileInput.files[0]) {
                try { slipUrl = await resizeAndConvertToBase64(fileInput.files[0]); } catch(e) {}
            }

            await db.collection("orders").add({
                customer: { name, tel, address: addr },
                items: cart,
                total: document.getElementById('sumTotal').innerText,
                shipping: shippingCost,
                payment: selectedPayment,
                slip: slipUrl,
                status: 'new',
                timestamp: new Date().toLocaleString()
            });

            alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£");
            cart = []; updateCartBadge();
            document.getElementById('loader').classList.add('hide');
            bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
            
            // Line
            if(shopConfig.lineId && confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏¢‡∏≠‡∏î‡∏ó‡∏≤‡∏á LINE ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                let msg = `‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà\n‡∏Ñ‡∏∏‡∏ì: ${name}\n‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${document.getElementById('sumTotal').innerText}`;
                window.open(`https://line.me/ti/p/~${shopConfig.lineId}?text=${encodeURIComponent(msg)}`, '_blank');
            }
        }

        // --- 4. Buffet Logic (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß: ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) ---
        function startBuffet(id) {
            currentBuffet = products.find(x => x.id === id);
            buffetSelection = [];
            document.getElementById('buffetName').innerText = currentBuffet.name;
            document.getElementById('buffetTarget').innerText = currentBuffet.credit || 1500;
            
            renderBuffetList();
            updateBuffetStat();
            new bootstrap.Modal(document.getElementById('buffetModal')).show();
        }
        
        function renderBuffetList() {
            const div = document.getElementById('buffetItemsList'); div.innerHTML = "";
            const txt = document.getElementById('searchBuffet').value.toLowerCase();
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤ Gift Set ‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠
            const items = products.filter(p => p.badge !== 'gift' && (!txt || p.name.toLowerCase().includes(txt)));
            
            if(items.length === 0) { div.innerHTML = "<div class='col-12 text-center py-5 text-muted'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏ã‡∏ï</div>"; return; }

            items.forEach(p => {
                let isSel = buffetSelection.find(x => x.id === p.id);
                div.innerHTML += `
                <div class="col-6 col-md-4 mb-3">
                    <div class="buffet-item p-2 h-100 ${isSel?'selected':''}" onclick="toggleBuf('${p.id}')">
                        <img src="${p.image}" class="w-100 rounded mb-2" style="height:100px; object-fit:cover;">
                        <div class="small fw-bold text-truncate">${p.name}</div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-danger small fw-bold">${p.price}.-</span>
                            <button class="btn btn-sm ${isSel?'btn-success':'btn-outline-primary'} py-0 px-2 small">${isSel?'‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß':'+ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'}</button>
                        </div>
                    </div>
                </div>`;
            });
        }

        function toggleBuf(id) {
            let p = products.find(x=>x.id===id);
            let idx = buffetSelection.findIndex(x=>x.id===id);
            if(idx > -1) buffetSelection.splice(idx,1); else buffetSelection.push(p);
            renderBuffetList(); updateBuffetStat();
        }
        
        function updateBuffetStat() {
            let total = buffetSelection.reduce((s,i)=>s+Number(i.price),0);
            let limit = Number(currentBuffet.credit || 1500);
            document.getElementById('buffetCurrentTotal').innerText = total.toLocaleString();
            document.getElementById('buffetMaxTotal').innerText = limit.toLocaleString();
            
            let pct = (total/limit)*100;
            document.getElementById('buffetProgressBar').style.width = Math.min(pct, 100) + "%";
            
            let btn = document.getElementById('btnFinishBuffet');
            let warn = document.getElementById('buffetWarning');
            
            if(total > limit) {
                btn.disabled = true;
                document.getElementById('buffetProgressBar').className = "progress-bar bg-danger";
                warn.innerText = `‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö‡πÑ‡∏õ ${(total-limit).toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            } else if(total === 0) {
                btn.disabled = true;
                warn.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡∏¥‡πâ‡∏ô";
            } else {
                btn.disabled = false;
                document.getElementById('buffetProgressBar').className = "progress-bar bg-success";
                warn.innerText = "";
            }
        }
        
        function finishBuffet() {
            let item = {
                ...currentBuffet,
                id: currentBuffet.id + '_' + Date.now(),
                isBuffet: true,
                buffetItems: buffetSelection,
                message: document.getElementById('buffetCardMsg').value,
                qty: 1
            };
            cart.push(item);
            updateCartBadge();
            bootstrap.Modal.getInstance(document.getElementById('buffetModal')).hide();
            openCart();
        }
        
        // Link wrapper for calling startBuffet from HTML onclick
        function openBuffetModal(id) { startBuffet(id); }
        function filterBuffetItems() { renderBuffetList(); }

        // --- Config & Admin ---
        function loadConfig() { 
            db.collection("settings").doc("shop").onSnapshot(d => { 
                if(d.exists) { 
                    shopConfig = d.data(); 
                    document.getElementById('navShopName').innerText = shopConfig.name || "‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡πà";
                    document.getElementById('shopBankInfo').innerText = shopConfig.payment || "‡∏£‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ";
                    // Admin Inputs
                    document.getElementById('conf_name').value = shopConfig.name;
                    document.getElementById('conf_payment').value = shopConfig.payment;
                    document.getElementById('conf_line_id').value = shopConfig.lineId;
                    document.getElementById('conf_fb').value = shopConfig.fb;
                    document.getElementById('conf_ig').value = shopConfig.ig;
                    document.getElementById('conf_tiktok').value = shopConfig.tiktok;
                    
                    if(shopConfig.logo) { document.getElementById('navbarLogo').src = shopConfig.logo; document.getElementById('navbarLogo').style.display = 'block'; }
                    const lb = document.getElementById('btnLineContact'); if(shopConfig.lineId){lb.style.display='block'; lb.onclick=()=>window.open('https://line.me/ti/p/~'+shopConfig.lineId,'_blank');} else {lb.style.display='none';}
                    
                    // Footer Socials
                    const fs = document.getElementById('linkFb'); if(shopConfig.fb) { fs.href=shopConfig.fb; fs.style.display='inline-block'; } else fs.style.display='none';
                    const is = document.getElementById('linkIg'); if(shopConfig.ig) { is.href=shopConfig.ig; is.style.display='inline-block'; } else is.style.display='none';
                    const ts = document.getElementById('linkTiktok'); if(shopConfig.tiktok) { ts.href=shopConfig.tiktok; ts.style.display='inline-block'; } else ts.style.display='none';
                } 
            }); 
        }
        function saveShopConfig() {
            let d = {
                name: document.getElementById('conf_name').value,
                payment: document.getElementById('conf_payment').value,
                lineId: document.getElementById('conf_line_id').value,
                fb: document.getElementById('conf_fb').value,
                ig: document.getElementById('conf_ig').value,
                tiktok: document.getElementById('conf_tiktok').value
            };
            const logoUrl = document.getElementById('logo_url').value; if(logoUrl) d.logo = logoUrl;
            db.collection("settings").doc("shop").set(d, {merge:true}).then(()=>alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"));
        }
        
        function renderAdminProducts() {
            const div = document.getElementById('adminProductList'); div.innerHTML = "";
            products.forEach(p => {
                div.innerHTML += `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <span>${p.name}</span>
                    <div>
                        <button class="btn btn-sm btn-warning me-1" onclick="editProduct('${p.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="db.collection('products').doc('${p.id}').delete()">üóëÔ∏è</button>
                    </div>
                </div>`;
            });
        }
        function toggleAdmin() { if(prompt("‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô")==="1234") { document.getElementById('adminPanel').style.display='block'; window.scrollTo(0,document.body.scrollHeight); } }
        function toggleAdminMin() { const p = document.getElementById('adminPanel'); p.classList.toggle('minimized'); }
        function editProduct(id) {
            const p = products.find(x=>x.id===id); if(!p)return;
            document.getElementById('p_name').value=p.name;
            document.getElementById('p_price').value=p.price;
            document.getElementById('p_badge').value=p.badge;
            document.getElementById('p_category').value=p.category;
            document.getElementById('p_credit').value=p.credit;
            editId=id; 
            document.getElementById('editAlert').classList.remove('d-none');
            document.getElementById('adminPanel').classList.remove('minimized');
            document.getElementById('adminPanel').style.display='block';
        }
        function saveProduct() {
            let data = {
                name: document.getElementById('p_name').value,
                price: document.getElementById('p_price').value,
                badge: document.getElementById('p_badge').value,
                category: document.getElementById('p_category').value,
                image: document.getElementById('p_image').value || document.getElementById('p_base64_storage').value,
                credit: document.getElementById('p_credit').value
            };
            if(editId) db.collection("products").doc(editId).update(data).then(()=>alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß"));
            else db.collection("products").add(data).then(()=>alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß"));
            cancelEdit();
        }
        function cancelEdit() { editId=null; document.getElementById('editAlert').classList.add('d-none'); }
        
        function loadCats() { db.collection("categories").onSnapshot(s => { const el = document.getElementById('p_category'); el.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î</option>"; s.forEach(d=> el.innerHTML+=`<option value='${d.data().name}'>${d.data().name}</option>`); }); }
        function addCategory() { const n = document.getElementById('newCatName').value; if(n) db.collection("categories").add({name:n}); }
        
        // Utils
        function searchProduct() { const t=document.getElementById('searchInput').value.toLowerCase(); renderAllProducts(products.filter(p=>p.name.toLowerCase().includes(t))); }
        function filterProducts(cat, btn) { document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const h=document.getElementById('highlightZone'); const g=document.getElementById('giftSection'); if(cat==='all'){h.style.display='block'; g.style.display='block'; renderAllProducts(products);} else{h.style.display='none'; g.style.display='none'; renderAllProducts(products.filter(p=>(p.category||"").trim()===cat.trim()));} }
        function calcPrice() { let full = Number(document.getElementById('p_price_full').value)||0; let disc = Number(document.getElementById('p_discount').value)||0; document.getElementById('p_price').value = Math.floor(full - (full * disc / 100)); }
        
        function openDetail(id) { 
            const p=products.find(x=>x.id===id); if(!p)return; 
            document.getElementById('detailImg').src=p.image||"https://via.placeholder.com/300"; 
            document.getElementById('detailName').innerText=p.name; 
            document.getElementById('detailCat').innerText=p.category||"‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"; 
            document.getElementById('detailPriceBox').innerText=p.price+" ‡∏ö‡∏≤‡∏ó"; 
            document.getElementById('detailDesc').innerText=p.desc||""; 
            const btn=document.getElementById('detailAddBtn'); 
            btn.onclick=function(){addToCart(id); var m=bootstrap.Modal.getInstance(document.getElementById('productDetailModal')); m.hide();};
            new bootstrap.Modal(document.getElementById('productDetailModal')).show(); 
        }
        
        async function previewImage(input) { if (input.files && input.files[0]) { try { const base64 = await resizeAndConvertToBase64(input.files[0]); document.getElementById('uploadZone').style.backgroundImage = `url(${base64})`; document.getElementById('uploadText').style.display = 'none'; document.getElementById('p_base64_storage').value = base64; } catch(e) { alert("‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: " + e); } } }
        async function resizeAndConvertToBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = (event) => { const img = new Image(); img.src = event.target.result; img.onload = () => { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const maxWidth = 500; const scaleSize = maxWidth / img.width; canvas.width = maxWidth; canvas.height = img.height * scaleSize; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); resolve(canvas.toDataURL('image/jpeg', 0.6)); }; img.onerror = reject; }; }); }
    </script>
</body>
</html>